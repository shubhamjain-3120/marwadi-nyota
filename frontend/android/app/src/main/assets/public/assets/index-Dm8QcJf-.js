const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DZYcYn8F.js","assets/react-vendor-wGySg1uH.js","assets/OnboardingScreen-BX8CVk4t.js","assets/ResultScreen-Dcta_gGd.js"])))=>i.map(i=>d[i]);
var ht=Object.defineProperty;var Ye=e=>{throw TypeError(e)};var vt=(e,t,o)=>t in e?ht(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var j=(e,t,o)=>vt(e,typeof t!="symbol"?t+"":t,o),Xe=(e,t,o)=>t.has(e)||Ye("Cannot "+o);var h=(e,t,o)=>(Xe(e,t,"read from private field"),o?o.call(e):t.get(e)),te=(e,t,o)=>t.has(e)?Ye("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,o),we=(e,t,o,n)=>(Xe(e,t,"write to private field"),n?n.call(e,o):t.set(e,o),o);import{r as g,a as wt,R as St}from"./react-vendor-wGySg1uH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function o(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=o(r);fetch(r.href,a)}})();var it={exports:{}},$e={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yt=g,xt=Symbol.for("react.element"),bt=Symbol.for("react.fragment"),Et=Object.prototype.hasOwnProperty,Ft=yt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Rt={key:!0,ref:!0,__self:!0,__source:!0};function st(e,t,o){var n,r={},a=null,s=null;o!==void 0&&(a=""+o),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(s=t.ref);for(n in t)Et.call(t,n)&&!Rt.hasOwnProperty(n)&&(r[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)r[n]===void 0&&(r[n]=t[n]);return{$$typeof:xt,type:e,key:a,ref:s,props:r,_owner:Ft.current}}$e.Fragment=bt;$e.jsx=st;$e.jsxs=st;it.exports=$e;var i=it.exports,ze={},Ke=wt;ze.createRoot=Ke.createRoot,ze.hydrateRoot=Ke.hydrateRoot;const Nt="modulepreload",kt=function(e){return"/"+e},Je={},We=function(t,o,n){let r=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=(s==null?void 0:s.nonce)||(s==null?void 0:s.getAttribute("nonce"));r=Promise.allSettled(o.map(d=>{if(d=kt(d),d in Je)return;Je[d]=!0;const m=d.endsWith(".css"),v=m?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${v}`))return;const u=document.createElement("link");if(u.rel=m?"stylesheet":Nt,m||(u.as="script"),u.crossOrigin="",u.href=d,l&&u.setAttribute("nonce",l),document.head.appendChild(u),m)return new Promise((w,f)=>{u.addEventListener("load",w),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return r.then(s=>{for(const l of s||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})};function At(){const[e,t]=g.useState(!1),[o,n]=g.useState(null),r=g.useRef(null),a=g.useRef(null),s=typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window),l=g.useCallback((m,v)=>{if(!s){alert("Voice input is not supported in this browser");return}r.current&&r.current.stop();const u=window.SpeechRecognition||window.webkitSpeechRecognition,w=new u;w.lang="en-IN",w.continuous=!1,w.interimResults=!1,w.maxAlternatives=1,a.current=v,w.onstart=()=>{t(!0),n(m)},w.onresult=f=>{const I=f.results[0][0].transcript,x=I.charAt(0).toUpperCase()+I.slice(1);a.current&&a.current(x)},w.onerror=f=>{console.error("Speech recognition error:",f.error),t(!1),n(null),f.error==="not-allowed"&&alert("Microphone access denied. Please allow microphone access.")},w.onend=()=>{t(!1),n(null),r.current=null},r.current=w,w.start()},[s]),d=g.useCallback(()=>{r.current&&r.current.stop()},[]);return{isListening:e,activeField:o,startListening:l,stopListening:d,isSupported:s}}const Lt="wedding-invite-dev-mode";function Ie(){try{return localStorage.getItem(Lt)==="true"}catch{return!1}}function $t(e,t,o=null){if(!Ie())return;const r=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${e}]`;o!=null?console.log(`${r} ${t}`,o):console.log(`${r} ${t}`)}function It(e,t,o){if(!Ie())return;const r=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${e}]`;console.error(`${r} ERROR - ${t}:`,o)}function Ct(e,t,o){if(!Ie())return;const r=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${e}]`;console.warn(`${r} WARN - ${t}:`,o)}function Ce(e){return{log:(t,o=null)=>$t(e,t,o),error:(t,o)=>It(e,t,o),warn:(t,o)=>Ct(e,t,o),isEnabled:Ie}}function lt(e,t={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event","page_view",{page_title:e,...t})}function Ee(e,t={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event",e,t)}const ke="wedding-invite-rate-limit",se=10,qe=7*24*60*60*1e3;function ye(){try{const t=localStorage.getItem(ke);if(t){const o=JSON.parse(t);if(Date.now()>o.resetAt){const n={count:0,resetAt:Date.now()+qe};return localStorage.setItem(ke,JSON.stringify(n)),{count:0,remaining:se,resetAt:n.resetAt,canGenerate:!0}}return{count:o.count,remaining:Math.max(0,se-o.count),resetAt:o.resetAt,canGenerate:o.count<se}}}catch(t){console.warn("[RateLimit] Failed to read state:",t)}const e={count:0,resetAt:Date.now()+qe};try{localStorage.setItem(ke,JSON.stringify(e))}catch(t){console.warn("[RateLimit] Failed to initialize state:",t)}return{count:0,remaining:se,resetAt:e.resetAt,canGenerate:!0}}function Ot(){try{const e=ye(),t=e.count+1,o={count:t,resetAt:e.resetAt};return localStorage.setItem(ke,JSON.stringify(o)),{count:t,remaining:Math.max(0,se-t),resetAt:e.resetAt,canGenerate:t<se}}catch(e){return console.warn("[RateLimit] Failed to increment count:",e),ye()}}function Ze(e){const t=Date.now(),o=e-t;if(o<=0)return"now";const n=Math.floor(o/(24*60*60*1e3)),r=Math.floor(o%(24*60*60*1e3)/(60*60*1e3));if(n>0)return`${n} day${n>1?"s":""}`;if(r>0)return`${r} hour${r>1?"s":""}`;const a=Math.floor(o/(60*1e3));return`${a} minute${a>1?"s":""}`}function Qe(){return se}const ie=Ce("InputScreen"),ct="wedding-invite-form-cache",Tt="Hotel Jain Ji Shubham",ge={name:50,venue:150},_e=e=>e?e.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim():"",Pt=10*1024*1024,Mt=["image/jpeg","image/png","image/webp","image/gif"],Bt=e=>e?e.size>Pt?{valid:!1,error:"File too large. Maximum size is 10MB."}:Mt.includes(e.type)?{valid:!0}:{valid:!1,error:"Invalid file type. Please upload a JPEG, PNG, WebP, or GIF image."}:{valid:!1,error:"No file selected"};function et(e){if(!e)return"";const t=new Date(e),o={day:"numeric",month:"long",year:"numeric"};return t.toLocaleDateString("en-IN",o)}function Dt(){try{const e=localStorage.getItem(ct);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load cached form data:",e)}return null}function jt(e){try{localStorage.setItem(ct,JSON.stringify(e))}catch(t){console.warn("Failed to save form data to cache:",t)}}function _t({onGenerate:e,error:t}){const[o,n]=g.useState(()=>ye());g.useEffect(()=>{lt("input"),n(ye())},[]);const r=g.useMemo(()=>Dt(),[]),[a,s]=g.useState((r==null?void 0:r.brideName)||""),[l,d]=g.useState((r==null?void 0:r.groomName)||""),[m,v]=g.useState((r==null?void 0:r.weddingDate)||""),[u,w]=g.useState((r==null?void 0:r.venue)||"");g.useEffect(()=>{jt({brideName:a,groomName:l,weddingDate:m,venue:u})},[a,l,m,u]);const[f,I]=g.useState(null),x=g.useMemo(()=>u.trim().toLowerCase()===Tt.toLowerCase(),[u]),[T,P]=g.useState(!1),[k,p]=g.useState(!1),[S,b]=g.useState(!1),[C,F]=g.useState(!1),[K,M]=g.useState(!1),[A,U]=g.useState(!1);g.useEffect(()=>{x&&!f&&(P(!0),fetch("/assets/dev-character.png").then(y=>{if(!y.ok)throw new Error("Failed to load dev character file");return y.blob()}).then(y=>{const D=y.type||"image/png",L=D.split("/")[1]||"png",Q=new File([y],`dev-character.${L}`,{type:D});I(Q),ie.log("Auto-loaded dev character into photo",{size:`${(Q.size/1024).toFixed(1)} KB`,detectedType:D})}).catch(y=>{ie.error("Failed to auto-load dev character file",y.message),console.error("Failed to load dev character file:",y)}).finally(()=>{P(!1)}))},[x]);const N=g.useRef(null),{isListening:B,activeField:q,startListening:fe,stopListening:Oe,isSupported:ae}=At(),de=(y,D)=>{B&&q===y?Oe():(Ee("voice_input_start",{field_name:y}),fe(y,D))},ue=f!==null,Y=g.useMemo(()=>f?URL.createObjectURL(f):null,[f]);g.useEffect(()=>()=>{Y&&URL.revokeObjectURL(Y)},[Y]);const me=y=>{const D=Array.from(y.target.files||[]);if(D.length===0)return;const L=D[0],Q=Bt(L);if(!Q.valid){alert(Q.error),y.target.value="";return}I(L),y.target.value=""},he=()=>{Ee("photo_change"),I(null)},Te=y=>{y.preventDefault(),ie.log("Form submission started",{devMode:x,hasPhoto:!!f});const D=ye();if(n(D),!D.canGenerate&&!x){ie.warn("Rate limit","Generation limit reached"),alert(`You've reached the limit of ${Qe()} invites per week. Please try again in ${Ze(D.resetAt)}.`);return}if(!a.trim()||!l.trim()||!m||!u.trim()){ie.warn("Form validation","Missing required fields"),alert("Please fill all fields");return}if(!f){ie.warn("Form validation","Photo required"),alert("Please upload a couple photo");return}const L={brideName:_e(a),groomName:_e(l),date:et(m),venue:_e(u),photo:f,devMode:x,characterFile:x?f:null,skipExtraction:x?k:!1,skipImageGeneration:x?S:!1,skipBackgroundRemoval:x?C:!1,skipVideoGeneration:x?K:!1,forceServerConversion:x?A:!1};ie.log("Form validation passed, calling onGenerate",{brideName:L.brideName,groomName:L.groomName,date:L.date,venue:L.venue,devMode:L.devMode,skipExtraction:L.skipExtraction,skipImageGeneration:L.skipImageGeneration,skipBackgroundRemoval:L.skipBackgroundRemoval,skipVideoGeneration:L.skipVideoGeneration,forceServerConversion:L.forceServerConversion,photoSize:f?`${(f.size/1024).toFixed(1)} KB`:null}),Ee("generate_submit",{dev_mode:x}),e(L)},Pe=()=>ue?i.jsxs("div",{className:"photo-single",children:[i.jsx("div",{className:"photo-card photo-card-large",children:i.jsx("div",{className:"photo-preview",children:i.jsx("img",{src:Y,alt:"Couple photo"})})}),i.jsx("button",{type:"button",className:"change-photos-btn",onClick:he,children:"Change Photo"})]}):i.jsx("div",{className:"photo-upload-empty",children:i.jsxs("button",{type:"button",className:"upload-btn upload-btn-large",onClick:()=>{var y;Ee("photo_upload_click"),(y=N.current)==null||y.click()},children:[i.jsx("span",{className:"upload-icon",children:"+"}),i.jsx("span",{className:"upload-text",children:"Upload Photo"}),i.jsx("span",{className:"upload-text-hindi",children:"‡§´‡§º‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç"}),i.jsx("span",{className:"upload-hint",children:"Select a couple photo with both groom and bride"}),i.jsx("span",{className:"upload-hint-hindi",children:"‡§¶‡•Ç‡§≤‡•ç‡§π‡§æ-‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡•Ä ‡§´‡§º‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç"})]})});return i.jsxs("div",{className:"input-screen",children:[t&&i.jsx("div",{className:"error-banner",children:t}),i.jsxs("form",{onSubmit:Te,className:"form",children:[i.jsxs("div",{className:"form-row",children:[i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"groomName",children:"Groom Name / ‡§¶‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),i.jsxs("div",{className:"input-with-voice",children:[i.jsx("input",{type:"text",id:"groomName",value:l,onChange:y=>d(y.target.value),placeholder:"Enter groom's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:ge.name,required:!0}),ae&&i.jsx("button",{type:"button",className:`voice-btn ${B&&q==="groomName"?"listening":""}`,onClick:()=>de("groomName",d),"aria-label":"Voice input for groom name",children:i.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[i.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),i.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),l.length>=ge.name&&i.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"brideName",children:"Bride Name / ‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),i.jsxs("div",{className:"input-with-voice",children:[i.jsx("input",{type:"text",id:"brideName",value:a,onChange:y=>s(y.target.value),placeholder:"Enter bride's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:ge.name,required:!0}),ae&&i.jsx("button",{type:"button",className:`voice-btn ${B&&q==="brideName"?"listening":""}`,onClick:()=>de("brideName",s),"aria-label":"Voice input for bride name",children:i.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[i.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),i.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),a.length>=ge.name&&i.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"weddingDate",children:"Wedding Date / ‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ"}),i.jsx("input",{type:"date",id:"weddingDate",value:m,onChange:y=>v(y.target.value),required:!0}),m&&i.jsx("span",{className:"date-preview",children:et(m)})]}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{htmlFor:"venue",children:"Venue & City / ‡§∏‡•ç‡§•‡§æ‡§®"}),i.jsxs("div",{className:"input-with-voice",children:[i.jsx("input",{type:"text",id:"venue",value:u,onChange:y=>w(y.target.value),placeholder:"e.g., Hotel Rambagh Palace, Jaipur",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:ge.venue,required:!0}),ae&&i.jsx("button",{type:"button",className:`voice-btn ${B&&q==="venue"?"listening":""}`,onClick:()=>de("venue",w),"aria-label":"Voice input for venue",children:i.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[i.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),i.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),u.length>=ge.venue&&i.jsx("span",{className:"field-error",children:"Text is too long / ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),x&&i.jsx("div",{className:"form-group",children:i.jsxs("div",{className:"dev-mode-section",children:[i.jsx("p",{className:"dev-mode-hint",children:"Dev Mode Active - Control which pipeline steps to skip"}),i.jsxs("div",{className:"dev-toggles-panel",children:[i.jsxs("div",{className:"dev-toggle-row",children:[i.jsx("span",{className:"dev-toggle-label",children:"Skip Extraction"}),i.jsx("button",{type:"button",className:`toggle-switch ${k?"toggle-on":""}`,onClick:()=>p(!k),"aria-label":"Toggle skip extraction",children:i.jsx("span",{className:"toggle-knob"})})]}),i.jsxs("div",{className:"dev-toggle-row",children:[i.jsx("span",{className:"dev-toggle-label",children:"Skip Image Generation"}),i.jsx("button",{type:"button",className:`toggle-switch ${S?"toggle-on":""}`,onClick:()=>b(!S),"aria-label":"Toggle skip image generation",children:i.jsx("span",{className:"toggle-knob"})})]}),i.jsxs("div",{className:"dev-toggle-row",children:[i.jsx("span",{className:"dev-toggle-label",children:"Skip Background Removal"}),i.jsx("button",{type:"button",className:`toggle-switch ${C?"toggle-on":""}`,onClick:()=>F(!C),"aria-label":"Toggle skip background removal",children:i.jsx("span",{className:"toggle-knob"})})]}),i.jsxs("div",{className:"dev-toggle-row",children:[i.jsx("span",{className:"dev-toggle-label",children:"Skip Video Generation"}),i.jsx("button",{type:"button",className:`toggle-switch ${K?"toggle-on":""}`,onClick:()=>M(!K),"aria-label":"Toggle skip video generation",children:i.jsx("span",{className:"toggle-knob"})})]}),i.jsxs("div",{className:"dev-toggle-row",children:[i.jsx("span",{className:"dev-toggle-label",children:"Force Server FFmpeg"}),i.jsx("button",{type:"button",className:`toggle-switch ${A?"toggle-on":""}`,onClick:()=>U(!A),"aria-label":"Toggle force server-side video conversion",children:i.jsx("span",{className:"toggle-knob"})})]})]}),T&&i.jsx("div",{className:"character-file-loading",children:"Loading dev character..."})]})}),i.jsxs("div",{className:"form-group",children:[i.jsx("label",{children:"Photo / ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞"}),i.jsx("input",{type:"file",ref:N,accept:"image/*",onChange:me,style:{display:"none"}}),Pe()]}),i.jsx("button",{type:"submit",className:"generate-btn",disabled:x?!ue||T:!ue||!o.canGenerate,children:x?"Generate Invite (Dev Mode)":"Generate Invite (‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§®‡§æ‡§è‡§Ç)"}),!x&&i.jsx("div",{className:`rate-limit-info ${o.remaining<=2?"rate-limit-warning":""}`,children:o.canGenerate?i.jsxs("span",{children:[o.remaining," of ",Qe()," generations remaining this week",o.remaining<=2&&" ‚ö†Ô∏è"]}):i.jsxs("span",{className:"rate-limit-exceeded",children:["Limit reached. Resets in ",Ze(o.resetAt)]})})]})]})}function zt({completed:e=!1}){const[t,o]=g.useState(0);return g.useEffect(()=>{lt("loading")},[]),g.useEffect(()=>{e&&o(100)},[e]),g.useEffect(()=>{if(e||t>=90)return;const n=setInterval(()=>{o(r=>{if(r>=90)return clearInterval(n),90;const a=Math.floor(Math.random()*3)+1;return Math.min(r+a,90)})},1430);return()=>clearInterval(n)},[e,t>=90]),g.useEffect(()=>{if(t<90||e)return;const n=setInterval(()=>{o(r=>r>=99?(clearInterval(n),99):r+1)},7150);return()=>clearInterval(n)},[t>=90,e]),i.jsx("div",{className:"loading-screen",children:i.jsxs("div",{className:"loading-content",children:[i.jsx("h2",{className:"loading-text",children:"‡§¨‡§∏ 2 ‡§Æ‡§ø‡§®‡§ü ‡§∏‡§æ ‡§Ü‡§™‡§∞‡•ã ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§® ‡§∞‡§π‡•ç‡§Ø‡•ã ‡§π‡•à üòä"}),i.jsx("div",{className:"mascot-container mascot-container-large",children:i.jsx("img",{src:"/assets/mascot.png",alt:"Loading mascot",className:"mascot mascot-large",onError:n=>{n.target.style.display="none"}})}),i.jsxs("div",{className:"progress-container",children:[i.jsx("div",{className:"progress-bar",children:i.jsx("div",{className:"progress-fill",style:{width:`${t}%`}})}),i.jsxs("span",{className:"progress-text",children:[Math.round(t),"%"]})]}),i.jsx("p",{className:"loading-subtext",children:"Creating your beautiful wedding invite..."})]})})}var E;(function(e){e.LOAD="LOAD",e.EXEC="EXEC",e.FFPROBE="FFPROBE",e.WRITE_FILE="WRITE_FILE",e.READ_FILE="READ_FILE",e.DELETE_FILE="DELETE_FILE",e.RENAME="RENAME",e.CREATE_DIR="CREATE_DIR",e.LIST_DIR="LIST_DIR",e.DELETE_DIR="DELETE_DIR",e.ERROR="ERROR",e.DOWNLOAD="DOWNLOAD",e.PROGRESS="PROGRESS",e.LOG="LOG",e.MOUNT="MOUNT",e.UNMOUNT="UNMOUNT"})(E||(E={}));const Gt=(()=>{let e=0;return()=>e++})(),Ut=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Wt=new Error("called FFmpeg.terminate()");var W,re,Z,le,ce,Le,_;class Vt{constructor(){te(this,W,null);te(this,re,{});te(this,Z,{});te(this,le,[]);te(this,ce,[]);j(this,"loaded",!1);te(this,Le,()=>{h(this,W)&&(h(this,W).onmessage=({data:{id:t,type:o,data:n}})=>{switch(o){case E.LOAD:this.loaded=!0,h(this,re)[t](n);break;case E.MOUNT:case E.UNMOUNT:case E.EXEC:case E.FFPROBE:case E.WRITE_FILE:case E.READ_FILE:case E.DELETE_FILE:case E.RENAME:case E.CREATE_DIR:case E.LIST_DIR:case E.DELETE_DIR:h(this,re)[t](n);break;case E.LOG:h(this,le).forEach(r=>r(n));break;case E.PROGRESS:h(this,ce).forEach(r=>r(n));break;case E.ERROR:h(this,Z)[t](n);break}delete h(this,re)[t],delete h(this,Z)[t]})});te(this,_,({type:t,data:o},n=[],r)=>h(this,W)?new Promise((a,s)=>{const l=Gt();h(this,W)&&h(this,W).postMessage({id:l,type:t,data:o},n),h(this,re)[l]=a,h(this,Z)[l]=s,r==null||r.addEventListener("abort",()=>{s(new DOMException(`Message # ${l} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(Ut));j(this,"load",({classWorkerURL:t,...o}={},{signal:n}={})=>(h(this,W)||(we(this,W,t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),h(this,Le).call(this)),h(this,_).call(this,{type:E.LOAD,data:o},void 0,n)));j(this,"exec",(t,o=-1,{signal:n}={})=>h(this,_).call(this,{type:E.EXEC,data:{args:t,timeout:o}},void 0,n));j(this,"ffprobe",(t,o=-1,{signal:n}={})=>h(this,_).call(this,{type:E.FFPROBE,data:{args:t,timeout:o}},void 0,n));j(this,"terminate",()=>{const t=Object.keys(h(this,Z));for(const o of t)h(this,Z)[o](Wt),delete h(this,Z)[o],delete h(this,re)[o];h(this,W)&&(h(this,W).terminate(),we(this,W,null),this.loaded=!1)});j(this,"writeFile",(t,o,{signal:n}={})=>{const r=[];return o instanceof Uint8Array&&r.push(o.buffer),h(this,_).call(this,{type:E.WRITE_FILE,data:{path:t,data:o}},r,n)});j(this,"mount",(t,o,n)=>{const r=[];return h(this,_).call(this,{type:E.MOUNT,data:{fsType:t,options:o,mountPoint:n}},r)});j(this,"unmount",t=>{const o=[];return h(this,_).call(this,{type:E.UNMOUNT,data:{mountPoint:t}},o)});j(this,"readFile",(t,o="binary",{signal:n}={})=>h(this,_).call(this,{type:E.READ_FILE,data:{path:t,encoding:o}},void 0,n));j(this,"deleteFile",(t,{signal:o}={})=>h(this,_).call(this,{type:E.DELETE_FILE,data:{path:t}},void 0,o));j(this,"rename",(t,o,{signal:n}={})=>h(this,_).call(this,{type:E.RENAME,data:{oldPath:t,newPath:o}},void 0,n));j(this,"createDir",(t,{signal:o}={})=>h(this,_).call(this,{type:E.CREATE_DIR,data:{path:t}},void 0,o));j(this,"listDir",(t,{signal:o}={})=>h(this,_).call(this,{type:E.LIST_DIR,data:{path:t}},void 0,o));j(this,"deleteDir",(t,{signal:o}={})=>h(this,_).call(this,{type:E.DELETE_DIR,data:{path:t}},void 0,o))}on(t,o){t==="log"?h(this,le).push(o):t==="progress"&&h(this,ce).push(o)}off(t,o){t==="log"?we(this,le,h(this,le).filter(n=>n!==o)):t==="progress"&&we(this,ce,h(this,ce).filter(n=>n!==o))}}W=new WeakMap,re=new WeakMap,Z=new WeakMap,le=new WeakMap,ce=new WeakMap,Le=new WeakMap,_=new WeakMap;var tt;(function(e){e.MEMFS="MEMFS",e.NODEFS="NODEFS",e.NODERAWFS="NODERAWFS",e.IDBFS="IDBFS",e.WORKERFS="WORKERFS",e.PROXYFS="PROXYFS"})(tt||(tt={}));const Ht=new Error("failed to get response body reader"),Yt=new Error("failed to complete download"),Xt="Content-Length",Kt=e=>new Promise((t,o)=>{const n=new FileReader;n.onload=()=>{const{result:r}=n;r instanceof ArrayBuffer?t(new Uint8Array(r)):t(new Uint8Array)},n.onerror=r=>{var a,s;o(Error(`File could not be read! Code=${((s=(a=r==null?void 0:r.target)==null?void 0:a.error)==null?void 0:s.code)||-1}`))},n.readAsArrayBuffer(e)}),Jt=async e=>{let t;if(typeof e=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(o=>o.charCodeAt(0)):t=await(await fetch(e)).arrayBuffer();else if(e instanceof URL)t=await(await fetch(e)).arrayBuffer();else if(e instanceof File||e instanceof Blob)t=await Kt(e);else return new Uint8Array;return new Uint8Array(t)},qt=async(e,t)=>{var r;const o=await fetch(e);let n;try{const a=parseInt(o.headers.get(Xt)||"-1"),s=(r=o.body)==null?void 0:r.getReader();if(!s)throw Ht;const l=[];let d=0;for(;;){const{done:u,value:w}=await s.read(),f=w?w.length:0;if(u){if(a!=-1&&a!==d)throw Yt;t&&t({url:e,total:a,received:d,delta:f,done:u});break}l.push(w),d+=f,t&&t({url:e,total:a,received:d,delta:f,done:u})}const m=new Uint8Array(d);let v=0;for(const u of l)m.set(u,v),v+=u.length;n=m.buffer}catch(a){console.log("failed to send download progress event: ",a),n=await o.arrayBuffer()}return n},ot=async(e,t,o=!1,n)=>{const r=o?await qt(e,n):await(await fetch(e)).arrayBuffer(),a=new Blob([r],{type:t});return URL.createObjectURL(a)},c=Ce("VideoComposer"),Zt="".replace(/\/+$/,"");let ne=null,Ge=!1;function Ae(){const e=typeof SharedArrayBuffer<"u";return c.log("FFmpeg support check",{sharedArrayBufferAvailable:e,userAgent:navigator.userAgent.slice(0,100)}),e}async function dt(e){if(Ge&&ne)return c.log("FFmpeg already loaded, reusing instance"),ne;c.log("Initializing FFmpeg.wasm");const t=performance.now();ne=new Vt,ne.on("log",({message:n})=>{c.log("FFmpeg log",{message:n})}),ne.on("progress",({progress:n,time:r})=>{if(c.log("FFmpeg progress",{progress:`${(n*100).toFixed(1)}%`,time:r?`${(r/1e6).toFixed(2)}s`:"N/A"}),e){const a=90+Math.round(n*10);e(Math.min(a,99))}});const o="https://unpkg.com/@ffmpeg/core@0.12.6/dist/umd";c.log("Fetching FFmpeg core files",{baseURL:o});try{const[n,r]=await Promise.all([ot(`${o}/ffmpeg-core.js`,"text/javascript"),ot(`${o}/ffmpeg-core.wasm`,"application/wasm")]);c.log("FFmpeg core files fetched, loading WASM");const a=ne.load({coreURL:n,wasmURL:r}),s=new Promise((d,m)=>{setTimeout(()=>{m(new Error("FFmpeg load timeout after 30s - likely missing SharedArrayBuffer/COOP/COEP headers"))},3e4)});await Promise.race([a,s]),Ge=!0;const l=performance.now()-t;return c.log("FFmpeg loaded successfully",{loadTime:`${l.toFixed(0)}ms`}),ne}catch(n){throw c.error("FFmpeg load failed",n),n}}async function Qt(){if(!Ae()){c.log("FFmpeg preload skipped - SharedArrayBuffer not available (will use server fallback)");return}if(Ge&&ne){c.log("FFmpeg already loaded, skipping preload");return}c.log("Preloading FFmpeg.wasm in background...");try{await dt(),c.log("FFmpeg preload complete")}catch(e){c.warn("FFmpeg preload failed (will retry on use)",e.message)}}async function nt(e,t){const o=performance.now();c.log("Starting server-side WebM to MP4 conversion",{inputSize:`${(e.size/1024/1024).toFixed(2)} MB`,inputType:e.type});const n=new FormData;return n.append("video",e,"input.webm"),new Promise((r,a)=>{const s=new XMLHttpRequest;s.upload.onprogress=l=>{if(l.lengthComputable){const d=70+l.loaded/l.total*15;c.log("Server upload progress",{uploaded:`${(l.loaded/1024/1024).toFixed(2)} MB`,total:`${(l.total/1024/1024).toFixed(2)} MB`,progress:`${d.toFixed(1)}%`}),t&&t(Math.round(d))}},s.upload.onloadend=()=>{c.log("Upload complete, waiting for server conversion"),t&&t(85)},s.onload=async()=>{const l=performance.now()-o;if(s.status===200){const d=s.getResponseHeader("Content-Type");if(d&&d.includes("video/mp4")){const m=s.response;c.log("Server conversion complete",{outputSize:`${(m.size/1024/1024).toFixed(2)} MB`,compressionRatio:`${((1-m.size/e.size)*100).toFixed(1)}%`,totalTime:`${l.toFixed(0)}ms`}),t&&t(95),r(m)}else try{const m=await new Blob([s.response]).text(),v=JSON.parse(m);a(new Error(v.error||"Server conversion failed"))}catch{a(new Error("Server conversion failed: unexpected response"))}}else c.error("Server conversion failed",{status:s.status,statusText:s.statusText}),a(new Error(`Server conversion failed: ${s.status} ${s.statusText}`))},s.onerror=()=>{const l=performance.now()-o;c.error("Server conversion network error",{totalTime:`${l.toFixed(0)}ms`}),a(new Error("Network error during video conversion"))},s.ontimeout=()=>{c.error("Server conversion timeout"),a(new Error("Video conversion timed out"))},s.open("POST",`${Zt}/api/convert-video`),s.responseType="blob",s.timeout=18e4,s.send(n)})}async function eo(e,t){const o=performance.now();c.log("Starting client-side WebM to MP4 conversion",{inputSize:`${(e.size/1024/1024).toFixed(2)} MB`,inputType:e.type});const n=await dt(t);c.log("Writing input file to FFmpeg virtual filesystem");const r=performance.now();await n.writeFile("input.webm",await Jt(e)),c.log("Input file written",{writeTime:`${(performance.now()-r).toFixed(0)}ms`});const a=["-i","input.webm","-c:v","libx264","-preset","ultrafast","-crf","23","-c:a","aac","-b:a","96k","-movflags","+faststart","-pix_fmt","yuv420p","output.mp4"];c.log("Executing FFmpeg conversion",{command:`ffmpeg ${a.join(" ")}`,codec:"H.264 (libx264)",preset:"ultrafast",crf:23,audioCodec:"AAC",audioBitrate:"96k"});const s=performance.now();try{await n.exec(a),c.log("FFmpeg execution complete",{execTime:`${(performance.now()-s).toFixed(0)}ms`})}catch(u){throw c.error("FFmpeg execution failed",u),u}c.log("Reading output file from FFmpeg virtual filesystem");const l=await n.readFile("output.mp4");c.log("Output file read",{outputBytes:l.byteLength}),c.log("Cleaning up FFmpeg virtual filesystem"),await n.deleteFile("input.webm"),await n.deleteFile("output.mp4");const d=new Blob([l.buffer],{type:"video/mp4"}),m=performance.now()-o,v=((1-d.size/e.size)*100).toFixed(1);return c.log("Client-side MP4 conversion complete",{outputSize:`${(d.size/1024/1024).toFixed(2)} MB`,compressionRatio:`${v}%`,totalTime:`${m.toFixed(0)}ms`}),d}async function to(e,t,o=!1){if(o||!Ae())return c.log("Using server-side conversion",{reason:o?"explicit fallback":"SharedArrayBuffer not available"}),nt(e,t);try{return await eo(e,t)}catch(n){return c.warn("Client-side FFmpeg failed, falling back to server",n.message),nt(e,t)}}const O=1080,G=1920,X={character:{marginXPercent:.08,topPercent:.22,bottomPercent:.82,sizeMultiplier:2},shadow:{yPercent:.82,widthPercent:.45,heightPercent:.025,blur:30,opacity:.12},names:{yPercent:.1,fontRatio:2.405,maxWidthPercent:.88,letterSpacing:.02,fontFamily:"AlexBrush, 'Alex Brush', 'Great Vibes', cursive",fontWeight:"400"},date:{yPercent:.875,fontRatio:.9,letterSpacing:.02,fontFamily:"PlayfairDisplay, 'Playfair Display', Georgia, serif",fontWeight:"500",color:"#8B7355"},venue:{yPercent:.915,fontRatio:.9,letterSpacing:.02,fontFamily:"PlayfairDisplay, 'Playfair Display', Georgia, serif",fontWeight:"500",color:"#8B7355"},baseFontSize:54},H={goldPrimary:"#D4A853",goldMid:"#E6C066",goldRich:"#C9942B",goldBright:"#F0D78C",copperBrown:"#B87333",copperBrownLight:"#CD8544",copperBrownDark:"#8B5A2B"},oe={names:{start:2.5,end:3},date:{start:2.5,end:3},venue:{start:2.5,end:3},character:{start:5,end:6}},Ue={names:{logged25:!1,logged50:!1,logged100:!1},date:{logged25:!1,logged50:!1,logged100:!1},venue:{logged25:!1,logged50:!1,logged100:!1},character:{logged25:!1,logged50:!1,logged100:!1}};function oo(){Object.keys(Ue).forEach(e=>{Ue[e]={logged25:!1,logged50:!1,logged100:!1}})}function Fe(e,t){const o=Ue[e];o&&(t>=.25&&!o.logged25&&(o.logged25=!0,c.log(`Animation: ${e} reached 25% opacity`)),t>=.5&&!o.logged50&&(o.logged50=!0,c.log(`Animation: ${e} reached 50% opacity`)),t>=1&&!o.logged100&&(o.logged100=!0,c.log(`Animation: ${e} fully visible (100% opacity)`)))}function no(e){const t=performance.now(),o=e.startsWith("data:");return c.log("Loading image",{source:o?`data URL (${(e.length/1024).toFixed(1)}KB)`:e}),new Promise((n,r)=>{const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{c.log("Image loaded",{width:a.width,height:a.height,loadTime:`${(performance.now()-t).toFixed(0)}ms`}),n(a)},a.onerror=s=>{c.error("Image load failed",s),r(s)},a.src=e})}function ro(e){const t=performance.now();return c.log("Loading video",{source:e}),new Promise((o,n)=>{const r=document.createElement("video");r.crossOrigin="anonymous",r.playsInline=!0,r.preload="auto",r.onloadeddata=()=>{c.log("Video loaded",{width:r.videoWidth,height:r.videoHeight,duration:`${r.duration.toFixed(2)}s`,loadTime:`${(performance.now()-t).toFixed(0)}ms`}),o(r)},r.onerror=a=>{const s=new Error(`Failed to load video: ${a.message||"Unknown error"}`);c.error("Video load failed",s),n(s)},r.src=e,r.load()})}async function ao(){const e=performance.now();c.log("Loading fonts",{fonts:["AlexBrush","PlayfairDisplay","Inter","InterMedium"]});const t=new FontFace("AlexBrush","url(/fonts/AlexBrush-Regular.ttf)"),o=new FontFace("PlayfairDisplay","url(/fonts/PlayfairDisplay-Regular.ttf)"),n=new FontFace("Inter","url(/fonts/Inter-Regular.ttf)"),r=new FontFace("InterMedium","url(/fonts/Inter-Medium.ttf)");try{const a=await Promise.all([t.load(),o.load(),n.load(),r.load()]);a.forEach(s=>{s&&document.fonts.add(s)}),c.log("Fonts loaded successfully",{loadTime:`${(performance.now()-e).toFixed(0)}ms`,fontsLoaded:a.length})}catch(a){c.warn("Font loading failed, using fallbacks",a.message)}}function rt(e){return e&&e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}function Re(e,t,o){return e<t?0:e>=o?1:(e-t)/(o-t)}function io(e){const t=G*X.character.topPercent,o=G*X.character.bottomPercent,n=o-t,r=O*X.character.marginXPercent,a=O-r*2,s=e.width/e.height;let l,d;d=n,l=d*s,l>a&&(l=a,d=l/s);const m=X.character.sizeMultiplier;l*=m,d*=m;const v=(O-l)/2,u=o-d;return{x:v,y:u,width:l,height:d,feetY:o}}function so(e,t){const o=X.shadow,n=O/2,r=G*o.yPercent,a=O*o.widthPercent/2,s=G*o.heightPercent/2,l=e.createRadialGradient(n,r,0,n,r,Math.max(a,s));l.addColorStop(0,`rgba(30, 20, 15, ${o.opacity})`),l.addColorStop(.6,`rgba(30, 20, 15, ${o.opacity*.4})`),l.addColorStop(1,"rgba(30, 20, 15, 0)"),e.save(),e.filter=`blur(${o.blur}px)`,e.fillStyle=l,e.beginPath(),e.ellipse(n,r,a,s,0,0,Math.PI*2),e.fill(),e.restore()}function at(e,t,o,n,r){const a=e.createLinearGradient(t-n/2,o-r*.3,t+n/2,o+r*.3);return a.addColorStop(0,H.goldRich),a.addColorStop(.15,H.goldPrimary),a.addColorStop(.35,H.goldMid),a.addColorStop(.5,H.goldBright),a.addColorStop(.65,H.goldMid),a.addColorStop(.85,H.goldPrimary),a.addColorStop(1,H.goldRich),a}function lo(e,t,o,n,r){const a=e.createLinearGradient(t-n/2,o-r*.3,t+n/2,o+r*.3);return a.addColorStop(0,H.copperBrownDark),a.addColorStop(.2,H.copperBrown),a.addColorStop(.4,H.copperBrownLight),a.addColorStop(.6,H.copperBrownLight),a.addColorStop(.8,H.copperBrown),a.addColorStop(1,H.copperBrownDark),a}function co(e,t,o,n,r,a,s=0){let l=n;for(;l>r;){e.font=`${l}px ${a}`;const d=e.measureText(t),m=(t.length-1)*(l*s);if(d.width+m<=o)return l;l-=2}return r}function ut(e,t,o,n,r){const a=t.split(""),l=parseFloat(e.font)*r;let d=0;a.forEach(v=>{d+=e.measureText(v).width}),d+=(a.length-1)*l;let m=o-d/2;a.forEach(v=>{const u=e.measureText(v).width;e.fillText(v,m+u/2,n),m+=u+l})}function uo(e,t,o,n=1){if(n<=0)return;const r=X.names,a=G*r.yPercent,s=O*r.maxWidthPercent,l=X.baseFontSize*r.fontRatio,d=X.baseFontSize*1.2,m=13,v=rt(t),u=rt(o),w=" & ",f=`${v}${w}${u}`,I=v.length+u.length;let x=l;if(I>m){const M=m/I;x=l*M,x=Math.max(x,d)}const T=co(e,f,s,x,d,r.fontFamily,r.letterSpacing);e.save(),e.globalAlpha=n,e.font=`${r.fontWeight} ${T}px ${r.fontFamily}`,e.textAlign="left",e.textBaseline="middle";const P=e.measureText(v).width,k=e.measureText(w).width,p=e.measureText(u).width,S=P+k+p;let b=(O-S)/2;const C=at(e,b+P/2,a,P,T*1.5);e.shadowColor="rgba(166, 124, 61, 0.35)",e.shadowBlur=3,e.shadowOffsetX=0,e.shadowOffsetY=2,e.fillStyle=C,e.fillText(v,b,a),b+=P;const F=lo(e,b+k/2,a,k,T*1.5);e.shadowColor="rgba(139, 90, 43, 0.35)",e.fillStyle=F,e.fillText(w,b,a),b+=k;const K=at(e,b+p/2,a,p,T*1.5);e.shadowColor="rgba(166, 124, 61, 0.35)",e.fillStyle=K,e.fillText(u,b,a),e.restore()}function mo(e){try{const t=new Date(e);if(isNaN(t.getTime()))return e;const n=["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()],r=t.getDate(),a=t.getFullYear();return`${r} ${n} ${a}`}catch{return e}}function po(e,t,o=1){if(o<=0)return;const n=X.date,r=G*n.yPercent,a=X.baseFontSize*n.fontRatio,l=`Date: ${mo(t)}`;e.save(),e.globalAlpha=o,e.font=`${n.fontWeight} ${a}px ${n.fontFamily}`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(139, 115, 85, 0.2)",e.shadowBlur=2,e.shadowOffsetX=0,e.shadowOffsetY=1,e.fillStyle=n.color,ut(e,l,O/2,r,n.letterSpacing),e.restore()}function go(e,t,o=1){if(o<=0)return;const n=X.venue,r=G*n.yPercent,a=X.baseFontSize*n.fontRatio,s=`Venue: ${t}`,l=20,d=.5;let m=a;if(s.length>l){const v=l/s.length;m=a*Math.max(v,d)}e.save(),e.globalAlpha=o,e.font=`${n.fontWeight} ${m}px ${n.fontFamily}`,e.textAlign="center",e.textBaseline="middle",e.shadowColor="rgba(139, 115, 85, 0.2)",e.shadowBlur=2,e.shadowOffsetX=0,e.shadowOffsetY=1,e.fillStyle=n.color,ut(e,s,O/2,r,n.letterSpacing),e.restore()}function fo(e,t,o,n,r,a,s,l,d){e.clearRect(0,0,O,G);const m=t.videoWidth/t.videoHeight,v=O/G;let u,w,f,I;m>v?(w=G,u=w*m,f=(O-u)/2,I=0):(u=O,w=u/m,f=0,I=(G-w)/2),e.drawImage(t,f,I,u,w);const x=Re(d,oe.names.start,oe.names.end),T=Re(d,oe.date.start,oe.date.end),P=Re(d,oe.venue.start,oe.venue.end),k=Re(d,oe.character.start,oe.character.end);Fe("names",x),Fe("date",T),Fe("venue",P),Fe("character",k),k>0&&(e.save(),e.globalAlpha=k,so(e),e.restore()),k>0&&(e.save(),e.globalAlpha=k,e.drawImage(o,n.x,n.y,n.width,n.height),e.restore()),uo(e,r,a,x),po(e,s,T),go(e,l,P)}async function ho({characterImage:e,brideName:t,groomName:o,date:n,venue:r,forceServerConversion:a=!1,onProgress:s=()=>{}}){var u,w,f,I,x,T,P;const l=performance.now();let d={};oo();const m=()=>performance.memory?{usedJSHeap:`${(performance.memory.usedJSHeapSize/1024/1024).toFixed(1)}MB`,totalJSHeap:`${(performance.memory.totalJSHeapSize/1024/1024).toFixed(1)}MB`,limit:`${(performance.memory.jsHeapSizeLimit/1024/1024).toFixed(1)}MB`}:null,v=a||!Ae();c.log("=== VIDEO COMPOSITION STARTED ===",{brideName:t,groomName:o,date:n,venue:r,characterImageSize:e?`${(e.length/1024).toFixed(1)}KB`:"N/A",conversionMode:v?"server":"client",forceServerConversion:a,ffmpegSupported:Ae(),timestamp:new Date().toISOString(),memory:m()}),s(5);try{c.log("Step 1/8: Loading fonts");const k=performance.now();await ao(),d.fonts=performance.now()-k,c.log("Step 1/8 complete",{duration:`${d.fonts.toFixed(0)}ms`}),s(10),c.log("Step 2/8: Loading video and character assets");const p=performance.now(),[S,b]=await Promise.all([ro("/assets/background.mp4"),no(e)]);d.assets=performance.now()-p,c.log("Step 2/8 complete: Assets loaded",{duration:`${d.assets.toFixed(0)}ms`,video:{dimensions:`${S.videoWidth}x${S.videoHeight}`,duration:`${S.duration.toFixed(2)}s`,aspectRatio:(S.videoWidth/S.videoHeight).toFixed(2)},character:{dimensions:`${b.width}x${b.height}`,aspectRatio:(b.width/b.height).toFixed(2)},memory:m()}),s(20),c.log("Step 3/8: Calculating character placement");const C=io(b);c.log("Step 3/8 complete: Character bounds",{position:`(${C.x.toFixed(0)}, ${C.y.toFixed(0)})`,size:`${C.width.toFixed(0)}x${C.height.toFixed(0)}`,feetY:C.feetY.toFixed(0)}),c.log("Step 4/8: Setting up canvas and MediaRecorder");const F=performance.now(),K=document.createElement("canvas");K.width=O,K.height=G;const M=K.getContext("2d");c.log("Canvas created",{dimensions:`${O}x${G}`});const A=30,U=K.captureStream(A);c.log("Canvas stream created",{fps:A}),c.log("Setting up audio capture");const N=new(window.AudioContext||window.webkitAudioContext),B=N.createMediaElementSource(S),q=N.createMediaStreamDestination();B.connect(q),c.log("Audio context configured",{sampleRate:N.sampleRate,state:N.state});const fe=new MediaStream([...U.getVideoTracks(),...q.stream.getAudioTracks()]);c.log("Combined stream created",{videoTracks:fe.getVideoTracks().length,audioTracks:fe.getAudioTracks().length});const Oe=["video/webm;codecs=h264,opus","video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus"];let ae="video/webm;codecs=vp8,opus";for(const $ of Oe)if(MediaRecorder.isTypeSupported($)){ae=$;break}const de=4e6,ue=96e3,Y=new MediaRecorder(fe,{mimeType:ae,videoBitsPerSecond:de,audioBitsPerSecond:ue});d.setup=performance.now()-F,c.log("Step 4/8 complete: MediaRecorder configured",{duration:`${d.setup.toFixed(0)}ms`,mimeType:ae,videoBitrate:`${(de/1e6).toFixed(1)} Mbps`,audioBitrate:`${ue/1e3} kbps`});const me=[];let he=0;Y.ondataavailable=$=>{if($.data.size>0&&(me.push($.data),he++,he%10===0)){const J=me.reduce((ee,De)=>ee+De.size,0);c.log("Recording data chunk",{chunkCount:he,totalSize:`${(J/1024/1024).toFixed(2)}MB`})}},Y.onerror=$=>{var J,ee;c.error("MediaRecorder error",{error:((J=$.error)==null?void 0:J.message)||"Unknown error",name:(ee=$.error)==null?void 0:ee.name})},Y.onwarning=$=>{c.warn("MediaRecorder warning",$.message||"Unknown warning")};const Te=new Promise($=>{Y.onstop=()=>{const J=new Blob(me,{type:"video/webm"});c.log("Recording stopped, blob created",{chunks:me.length,size:`${(J.size/1024/1024).toFixed(2)}MB`,state:Y.state}),$(J)}});c.log("Step 5/8: Starting recording");const Pe=performance.now();Y.start(1e3),c.log("MediaRecorder started",{timeslice:"1000ms"}),S.currentTime=0,await new Promise($=>{S.onseeked=$}),c.log("Video seeked to start"),c.log("Step 6/8: Rendering frames",{targetDuration:`${S.duration.toFixed(2)}s`,targetFPS:A,canvasDimensions:`${O}x${G}`});const y=S.duration;let D=20,L=0,Q=0,xe=null,be=0,Me=0;await new Promise($=>{const J=()=>{if(xe===null&&(xe=performance.now()),S.ended||S.currentTime>=y){const ve=performance.now()-xe;c.log("Render loop complete",{totalFrames:L,videoDuration:`${y.toFixed(2)}s`,actualRenderTime:`${ve.toFixed(0)}ms`,avgFPS:(L/(ve/1e3)).toFixed(1),playbackSpeed:`${(y/(ve/1e3)).toFixed(2)}x`,memory:m()}),$();return}fo(M,S,b,C,t,o,n,r,S.currentTime),L++,Me++;const ee=performance.now();if(ee-be>=1e3){const ve=Me/((ee-be)/1e3);S.currentTime>0&&c.log("Real-time FPS",{fps:ve.toFixed(1),videoTime:`${S.currentTime.toFixed(1)}s`}),be=ee,Me=0}S.currentTime-Q>=5&&(c.log("Frame rendering progress",{videoTime:`${S.currentTime.toFixed(1)}s`,frames:L,progress:`${(S.currentTime/y*100).toFixed(1)}%`,elapsedReal:`${((performance.now()-xe)/1e3).toFixed(1)}s`}),Q=S.currentTime);const De=v?50:65,je=20+S.currentTime/y*De;je-D>=2&&(s(Math.round(je)),D=je),requestAnimationFrame(J)};S.onended=$,c.log("Starting video playback"),be=performance.now(),S.play(),J()}),d.recording=performance.now()-Pe,c.log("Step 6/8 complete: Rendering finished",{duration:`${d.recording.toFixed(0)}ms`,frames:L}),s(v?70:85),c.log("Step 7/8: Finalizing recording");const gt=performance.now();Y.stop(),c.log("MediaRecorder stop requested");const Be=await Te;await N.close(),c.log("Audio context closed"),d.finalize=performance.now()-gt,c.log("Step 7/8 complete: Recording finalized",{duration:`${d.finalize.toFixed(0)}ms`,webmSize:`${(Be.size/1024/1024).toFixed(2)}MB`});const Ve=v?"server-side FFmpeg":"FFmpeg.wasm";c.log(`Step 8/8: Converting WebM to MP4 using ${Ve}`);const ft=performance.now();let pe;try{pe=await to(Be,s,v),d.conversion=performance.now()-ft,c.log("Step 8/8 complete: MP4 conversion finished",{duration:`${d.conversion.toFixed(0)}ms`,outputSize:`${(pe.size/1024/1024).toFixed(2)}MB`,method:Ve})}catch($){c.warn("MP4 conversion failed, falling back to WebM",$.message),pe=Be}s(100);const He=performance.now()-l;return c.log("=== VIDEO COMPOSITION COMPLETE ===",{totalDuration:`${He.toFixed(0)}ms`,totalDurationHuman:`${(He/1e3).toFixed(1)}s`,conversionMode:v?"server":"client",output:{size:`${(pe.size/1024/1024).toFixed(2)}MB`,type:pe.type},stepTimings:{fonts:`${((u=d.fonts)==null?void 0:u.toFixed(0))||"N/A"}ms`,assets:`${((w=d.assets)==null?void 0:w.toFixed(0))||"N/A"}ms`,setup:`${((f=d.setup)==null?void 0:f.toFixed(0))||"N/A"}ms`,recording:`${((I=d.recording)==null?void 0:I.toFixed(0))||"N/A"}ms`,finalize:`${((x=d.finalize)==null?void 0:x.toFixed(0))||"N/A"}ms`,conversion:`${((T=d.conversion)==null?void 0:T.toFixed(0))||"N/A"}ms`},timestamp:new Date().toISOString(),memory:m()}),pe}catch(k){const p=performance.now()-l;throw c.error("=== VIDEO COMPOSITION FAILED ===",{error:k.message,stack:(P=k.stack)==null?void 0:P.slice(0,500),failedAfter:`${p.toFixed(0)}ms`,stepTimings:d}),k}}const V=Ce("BgRemoval");let Ne=null,Se=null;const vo={model:"medium",output:{format:"image/png",quality:1},progress:(e,t,o)=>{if(e==="compute:inference"){const n=Math.round(t/o*100);console.log(`[BgRemoval] Processing: ${n}%`)}}};async function wo(){if(Ne)return V.log("Library already loaded, using cached reference"),Ne;if(Se)return V.log("Library loading in progress, waiting..."),Se;V.log("Loading library dynamically..."),console.log("[BgRemoval] Loading library dynamically...");const e=performance.now();return Se=We(()=>import("./index-DZYcYn8F.js"),__vite__mapDeps([0,1])).then(t=>{Ne=t.removeBackground;const o=performance.now()-e;return V.log("Library loaded",{duration:`${o.toFixed(0)}ms`}),console.log("[BgRemoval] Library loaded"),Ne}).catch(t=>{throw Se=null,t}),Se}function mt(e){const[t,o]=e.split(","),n=t.match(/:(.*?);/),r=n?n[1]:"image/png",a=atob(o),s=new Uint8Array(a.length);for(let l=0;l<a.length;l++)s[l]=a.charCodeAt(l);return new Blob([s],{type:r})}function So(e){return new Promise((t,o)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=o,n.readAsDataURL(e)})}async function yo(e){V.log("Starting background removal",{inputLength:e==null?void 0:e.length}),console.log("[BgRemoval] Starting background removal...");const t=performance.now();try{V.log("Step 1: Loading library");const o=await wo();V.log("Step 2: Converting data URL to Blob");const n=mt(e);V.log("Step 2 complete: Input prepared",{inputSize:`${(n.size/1024).toFixed(1)} KB`}),console.log(`[BgRemoval] Input size: ${(n.size/1024).toFixed(1)} KB`),V.log("Step 3: Calling removeBackground() - this may take a while...");const r=performance.now(),a=await o(n,vo),s=performance.now()-r;V.log("Step 3 complete: Background removed",{processingTime:`${s.toFixed(0)}ms`,resultSize:`${(a.size/1024).toFixed(1)} KB`}),V.log("Step 4: Converting result to data URL");const l=await So(a),d=performance.now()-t;return V.log("Background removal complete",{totalDuration:`${d.toFixed(0)}ms`,inputSize:`${(n.size/1024).toFixed(1)} KB`,outputSize:`${(a.size/1024).toFixed(1)} KB`}),console.log(`[BgRemoval] Complete in ${d.toFixed(0)}ms`),console.log(`[BgRemoval] Output size: ${(a.size/1024).toFixed(1)} KB`),l}catch(o){throw V.error("Background removal failed",o),console.error("[BgRemoval] Error:",o),new Error(`Background removal failed: ${o.message}`)}}const xo=g.lazy(()=>We(()=>import("./OnboardingScreen-BX8CVk4t.js"),__vite__mapDeps([2,1]))),bo=g.lazy(()=>We(()=>import("./ResultScreen-Dcta_gGd.js"),__vite__mapDeps([3,1]))),R=Ce("App"),Eo=()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),i.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"}),i.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),Fo=()=>i.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[i.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),i.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),i.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),Ro="".replace(/\/+$/,""),z={ONBOARDING:"onboarding",INPUT:"input",LOADING:"loading",RESULT:"result"},pt="hasSeenOnboarding";function No(){try{return localStorage.getItem(pt)==="true"}catch{return!1}}function ko(){try{localStorage.setItem(pt,"true")}catch{}}const Ao=500,Lo=3,$o=1e3;async function Io(e,t,o=Lo){let n;for(let r=0;r<o;r++){try{const a=await fetch(e,t);if(a.ok||a.status>=400&&a.status<500)return a;n=new Error(`Server error: ${a.status}`),R.warn(`API attempt ${r+1} failed with status ${a.status}`)}catch(a){n=a,R.warn(`API attempt ${r+1} failed: ${a.message}`)}if(r<o-1){const a=$o*Math.pow(2,r);R.log(`Retrying in ${a}ms...`),await new Promise(s=>setTimeout(s,a))}}throw n}function Co(){const[e,t]=g.useState(typeof navigator<"u"?navigator.onLine:!0);return g.useEffect(()=>{const o=()=>{t(!0),R.log("Network status: online")},n=()=>{t(!1),R.log("Network status: offline")};return window.addEventListener("online",o),window.addEventListener("offline",n),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",n)}},[]),e}function Oo(){const[e,t]=g.useState(()=>No()?z.INPUT:z.ONBOARDING),[o,n]=g.useState(null),[r,a]=g.useState(null),[s,l]=g.useState(null),[d,m]=g.useState(!1),v=Co(),[u,w]=g.useState(!0),f=g.useRef(null);g.useEffect(()=>{const p=new Audio("/assets/bg_audio.mp3");p.loop=!0,p.volume=.05,f.current=p;let S=!1;const b=async()=>{if(f.current&&f.current.paused)try{await f.current.play(),w(!0),console.log("[App] Music started after user interaction")}catch(F){console.log("[App] Could not play audio:",F.message)}document.removeEventListener("click",b),document.removeEventListener("touchstart",b),document.removeEventListener("keydown",b),S=!1};return(async()=>{try{await p.play(),w(!0),console.log("[App] Autoplay successful")}catch{console.log("[App] Autoplay blocked, waiting for user interaction"),document.addEventListener("click",b),document.addEventListener("touchstart",b),document.addEventListener("keydown",b),S=!0}})(),()=>{p.pause(),p.src="",S&&(document.removeEventListener("click",b),document.removeEventListener("touchstart",b),document.removeEventListener("keydown",b))}},[]);const I=g.useCallback(()=>{f.current&&(u?(f.current.pause(),w(!1)):(f.current.play().catch(()=>{console.log("[App] Could not play audio")}),w(!0)))},[u]);g.useEffect(()=>{e===z.RESULT&&f.current&&(f.current.pause(),w(!1),console.log("[App] Stopped background music for result screen"))},[e]),g.useEffect(()=>{(e===z.INPUT||e===z.ONBOARDING)&&Qt()},[e]);const x=g.useCallback(async p=>{var S,b,C;n(p),t(z.LOADING),m(!1),l(null),R.log("Generation started",{devMode:p.devMode,brideName:p.brideName,groomName:p.groomName,hasPhoto:!!p.photo,hasCharacterFile:!!p.characterFile,skipExtraction:p.skipExtraction,skipImageGeneration:p.skipImageGeneration,skipBackgroundRemoval:p.skipBackgroundRemoval,skipVideoGeneration:p.skipVideoGeneration,forceServerConversion:p.forceServerConversion});try{let F;if(p.devMode&&(p.skipExtraction||p.skipImageGeneration)&&p.characterFile)R.log("Step 1: Using local character file (dev mode - skipping API)",{fileName:p.characterFile.name,fileSize:`${(p.characterFile.size/1024).toFixed(1)} KB`,fileType:p.characterFile.type}),console.log("[App] Dev mode enabled - using local character file"),F=await new Promise((A,U)=>{const N=new FileReader;N.onload=()=>{A(N.result)},N.onerror=()=>{U(new Error("Failed to read character file"))},N.readAsDataURL(p.characterFile)}),R.log("Step 1 complete: Character file loaded as data URL",{dataUrlLength:F.length}),console.log("[App] Character file loaded, skipping API calls");else{if(!navigator.onLine)throw new Error("No internet connection. Please check your network and try again.");const A=new FormData;A.append("photo",p.photo),R.log("Step 1: Calling backend API",{photoName:p.photo.name,photoSize:`${(p.photo.size/1024).toFixed(1)} KB`,photoType:p.photo.type}),console.log("[App] Calling backend API...");const U=performance.now();let N;try{N=await Io(`${Ro}/api/generate`,{method:"POST",body:A})}catch(q){throw q}R.log("Step 1 response received",{status:N.status,ok:N.ok,duration:`${(performance.now()-U).toFixed(0)}ms`});const B=await N.json();if(!B.success)throw R.error("Step 1 failed",B.error||"Generation failed"),new Error(B.error||"Generation failed");R.log("Step 1 complete: Backend returned success",{hasCharacterImage:!!B.characterImage,imageLength:(S=B.characterImage)==null?void 0:S.length,evaluationScore:(b=B.evaluation)==null?void 0:b.score,evaluationPassed:(C=B.evaluation)==null?void 0:C.passed}),console.log("[App] Received image from backend"),F=B.characterImage}if(p.skipBackgroundRemoval)R.log("Step 2: Skipping background removal (dev mode toggle)"),console.log("[App] Skipping background removal (dev mode)");else{R.log("Step 2: Starting background removal"),console.log("[App] Removing background...");const A=performance.now();try{F=await yo(F),R.log("Step 2 complete: Background removal successful",{outputLength:F==null?void 0:F.length,duration:`${(performance.now()-A).toFixed(0)}ms`}),console.log("[App] Background removal complete")}catch(U){R.warn("Step 2",`Background removal failed, using original: ${U.message}`),console.warn("[App] Background removal failed, using original:",U.message)}}let M;if(p.skipVideoGeneration)R.log("Step 3: Skipping video generation (dev mode toggle)"),console.log("[App] Skipping video generation (dev mode)"),M=mt(F),R.log("Step 3 complete: Using image directly (no video)",{imageSize:`${((M==null?void 0:M.size)/1024).toFixed(1)} KB`});else{R.log("Step 3: Starting video composition",{brideName:p.brideName,groomName:p.groomName,date:p.date,venue:p.venue,characterImageLength:F==null?void 0:F.length,forceServerConversion:p.forceServerConversion}),console.log("[App] Composing video invite...");const A=performance.now();let U=0;M=await ho({characterImage:F,brideName:p.brideName,groomName:p.groomName,date:p.date,venue:p.venue,forceServerConversion:p.forceServerConversion,onProgress:N=>{(N>=U+20||N===100)&&(R.log("Video composition progress",{progress:`${N}%`,elapsed:`${(performance.now()-A).toFixed(0)}ms`}),U=N)}}),R.log("Step 3 complete: Video composition finished",{videoSize:`${((M==null?void 0:M.size)/1024/1024).toFixed(2)} MB`,duration:`${(performance.now()-A).toFixed(0)}ms`})}if(a(M),!p.devMode){const A=Ot();R.log("Rate limit updated",{count:A.count,remaining:A.remaining})}R.log("Step 4: Showing completion state"),console.log("[App] Generation complete! Showing 100% briefly..."),m(!0),await new Promise(A=>setTimeout(A,Ao)),R.log("Step 5: Transitioning to result screen"),t(z.RESULT),R.log("Generation complete - all steps successful")}catch(F){R.error("Generation failed",F),console.error("[App] Generation error:",F),l(F.message),t(z.INPUT)}},[]),T=g.useCallback(()=>{t(z.INPUT),n(null),a(null),l(null)},[]),P=g.useCallback(()=>{ko(),t(z.INPUT)},[]),k=()=>i.jsx("div",{className:"loading-fallback",children:i.jsx("div",{className:"loading-spinner"})});return i.jsxs("div",{className:"app",children:[!v&&i.jsx("div",{className:"offline-banner",children:"You are offline. Some features may not work."}),i.jsxs("header",{className:"app-header",children:[i.jsx("div",{className:"app-header-logo",children:i.jsx("img",{src:"/assets/app-logo.png",alt:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π",className:"app-header-logo-img"})}),i.jsxs("div",{className:"app-header-title",children:[i.jsx("h1",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π"}),i.jsx("p",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§ï‡•Ç‡§ï‡•Ç ‡§™‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç"})]}),i.jsx("div",{className:"app-header-actions",children:i.jsx("button",{className:"music-toggle-btn",onClick:I,"aria-label":u?"Mute background music":"Play background music",title:u?"Mute music":"Play music",children:u?i.jsx(Eo,{}):i.jsx(Fo,{})})})]}),i.jsxs(g.Suspense,{fallback:i.jsx(k,{}),children:[e===z.ONBOARDING&&i.jsx(xo,{onComplete:P}),e===z.RESULT&&i.jsx(bo,{inviteVideo:r,brideName:o==null?void 0:o.brideName,groomName:o==null?void 0:o.groomName,onReset:T})]}),e===z.INPUT&&i.jsx(_t,{onGenerate:x,error:s}),e===z.LOADING&&i.jsx(zt,{completed:d})]})}ze.createRoot(document.getElementById("root")).render(i.jsx(St.StrictMode,{children:i.jsx(Oo,{})}));export{We as _,Ee as a,Ce as c,i as j,lt as t};
