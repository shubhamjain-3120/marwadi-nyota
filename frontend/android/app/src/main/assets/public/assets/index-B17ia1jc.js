const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cirw06Jz.js","assets/react-vendor-wGySg1uH.js","assets/ResultScreen-WpKwGJZW.js"])))=>i.map(i=>d[i]);
import{r as c,a as He,R as Xe}from"./react-vendor-wGySg1uH.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=o(s);fetch(s.href,a)}})();var Ue={exports:{}},ge={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Je=c,Ze=Symbol.for("react.element"),Qe=Symbol.for("react.fragment"),et=Object.prototype.hasOwnProperty,tt=Je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,rt={key:!0,ref:!0,__self:!0,__source:!0};function Ve(r,t,o){var n,s={},a=null,i=null;o!==void 0&&(a=""+o),t.key!==void 0&&(a=""+t.key),t.ref!==void 0&&(i=t.ref);for(n in t)et.call(t,n)&&!rt.hasOwnProperty(n)&&(s[n]=t[n]);if(r&&r.defaultProps)for(n in t=r.defaultProps,t)s[n]===void 0&&(s[n]=t[n]);return{$$typeof:Ze,type:r,key:a,ref:i,props:s,_owner:tt.current}}ge.Fragment=Qe;ge.jsx=Ve;ge.jsxs=Ve;Ue.exports=ge;var e=Ue.exports,be={},Pe=He;be.createRoot=Pe.createRoot,be.hydrateRoot=Pe.hydrateRoot;const ot="modulepreload",st=function(r){return"/"+r},je={},ze=function(t,o,n){let s=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));s=Promise.allSettled(o.map(m=>{if(m=st(m),m in je)return;je[m]=!0;const p=m.endsWith(".css"),d=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${m}"]${d}`))return;const f=document.createElement("link");if(f.rel=p?"stylesheet":ot,p||(f.as="script"),f.crossOrigin="",f.href=m,l&&f.setAttribute("nonce",l),document.head.appendChild(f),p)return new Promise((g,b)=>{f.addEventListener("load",g),f.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${m}`)))})}))}function a(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return s.then(i=>{for(const l of i||[])l.status==="rejected"&&a(l.reason);return t().catch(a)})};function nt(){const[r,t]=c.useState(!1),[o,n]=c.useState(null),s=c.useRef(null),a=c.useRef(null),i=typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window),l=c.useCallback((p,d)=>{if(!i){alert("Voice input is not supported in this browser");return}s.current&&s.current.stop();const f=window.SpeechRecognition||window.webkitSpeechRecognition,g=new f;g.lang="en-IN",g.continuous=!1,g.interimResults=!1,g.maxAlternatives=1,a.current=d,g.onstart=()=>{t(!0),n(p)},g.onresult=b=>{const I=b.results[0][0].transcript,x=I.charAt(0).toUpperCase()+I.slice(1);a.current&&a.current(x)},g.onerror=b=>{console.error("Speech recognition error:",b.error),t(!1),n(null),b.error==="not-allowed"&&alert("Microphone access denied. Please allow microphone access.")},g.onend=()=>{t(!1),n(null),s.current=null},s.current=g,g.start()},[i]),m=c.useCallback(()=>{s.current&&s.current.stop()},[]);return{isListening:r,activeField:o,startListening:l,stopListening:m,isSupported:i}}const at="wedding-invite-dev-mode";function he(){try{return localStorage.getItem(at)==="true"}catch{return!1}}function it(r,t,o=null){if(!he())return;const s=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${r}]`;o!=null?console.log(`${s} ${t}`,o):console.log(`${s} ${t}`)}function lt(r,t,o){if(!he())return;const s=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${r}]`;console.error(`${s} ERROR - ${t}:`,o)}function ct(r,t,o){if(!he())return;const s=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${r}]`;console.warn(`${s} WARN - ${t}:`,o)}function oe(r){return{log:(t,o=null)=>it(r,t,o),error:(t,o)=>lt(r,t,o),warn:(t,o)=>ct(r,t,o),isEnabled:he}}function fe(r,t={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event","page_view",{page_title:r,...t})}function te(r,t={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event",r,t)}const pe="wedding-invite-rate-limit",re=10,Re=7*24*60*60*1e3;function ce(){try{const t=localStorage.getItem(pe);if(t){const o=JSON.parse(t);if(Date.now()>o.resetAt){const n={count:0,resetAt:Date.now()+Re};return localStorage.setItem(pe,JSON.stringify(n)),{count:0,remaining:re,resetAt:n.resetAt,canGenerate:!0}}return{count:o.count,remaining:Math.max(0,re-o.count),resetAt:o.resetAt,canGenerate:o.count<re}}}catch(t){console.warn("[RateLimit] Failed to read state:",t)}const r={count:0,resetAt:Date.now()+Re};try{localStorage.setItem(pe,JSON.stringify(r))}catch(t){console.warn("[RateLimit] Failed to initialize state:",t)}return{count:0,remaining:re,resetAt:r.resetAt,canGenerate:!0}}function dt(){try{const r=ce(),t=r.count+1,o={count:t,resetAt:r.resetAt};return localStorage.setItem(pe,JSON.stringify(o)),{count:t,remaining:Math.max(0,re-t),resetAt:r.resetAt,canGenerate:t<re}}catch(r){return console.warn("[RateLimit] Failed to increment count:",r),ce()}}function ke(r){const t=Date.now(),o=r-t;if(o<=0)return"now";const n=Math.floor(o/(24*60*60*1e3)),s=Math.floor(o%(24*60*60*1e3)/(60*60*1e3));if(n>0)return`${n} day${n>1?"s":""}`;if(s>0)return`${s} hour${s>1?"s":""}`;const a=Math.floor(o/(60*1e3));return`${a} minute${a>1?"s":""}`}function _e(){return re}const ee=oe("InputScreen"),Fe="wedding-invite-form-cache",ut="Hotel Jain Ji Shubham",W={name:50,venue:150},ie=r=>r?r.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim():"";function Ce(r){if(!r)return"";const t=new Date(r),o={day:"numeric",month:"long",year:"numeric"};return t.toLocaleDateString("en-IN",o)}function mt(){try{const r=localStorage.getItem(Fe);if(r)return JSON.parse(r)}catch{ee.warn("Cache","Failed to load cached form data")}return null}function pt(r){try{localStorage.setItem(Fe,JSON.stringify(r))}catch{ee.warn("Cache","Failed to save form data to cache")}}function gt({onGenerate:r,error:t,photo:o,onBack:n}){const[s,a]=c.useState(!1),[i,l]=c.useState(null),[m,p]=c.useState(()=>ce());c.useEffect(()=>{fe("input"),p(ce())},[]);const d=c.useMemo(()=>mt(),[]),[f,g]=c.useState((d==null?void 0:d.brideName)||""),[b,I]=c.useState((d==null?void 0:d.brideParentName)||""),[x,_]=c.useState((d==null?void 0:d.groomName)||""),[L,O]=c.useState((d==null?void 0:d.groomParentName)||""),[D,Q]=c.useState((d==null?void 0:d.weddingTime)||""),[M,P]=c.useState((d==null?void 0:d.weddingDate)||""),[y,G]=c.useState((d==null?void 0:d.venue)||"");c.useEffect(()=>{pt({brideName:f,brideParentName:b,groomName:x,groomParentName:L,weddingTime:D,weddingDate:M,venue:y})},[f,b,x,L,D,M,y]);const k=c.useMemo(()=>y.trim().toLowerCase()===ut.toLowerCase(),[y]),[U,Y]=c.useState(!1),[u,V]=c.useState(!1),[B,q]=c.useState(!1),[z,de]=c.useState(!1),{isListening:H,activeField:h,startListening:w,stopListening:ve,isSupported:X}=nt(),F=(S,N)=>{H&&h===S?ve():(te("voice_input_start",{field_name:S}),w(S,N))},se=o!==null,ye=S=>{S.preventDefault(),ee.log("Form submission started",{devMode:k,hasPhoto:!!o});const N=ce();if(p(N),!N.canGenerate&&!k){ee.warn("Rate limit","Generation limit reached"),alert(`You've reached the limit of ${_e()} invites per week. Please try again in ${ke(N.resetAt)}.`);return}if(!f.trim()||!x.trim()||!M||!y.trim()){ee.warn("Form validation","Missing required fields"),alert("Please fill all fields");return}if(!o){ee.warn("Form validation","Photo required - should not happen"),alert("No photo selected. Please go back and upload a photo.");return}const A={brideName:ie(f),brideParentName:ie(b),groomName:ie(x),groomParentName:ie(L),time:D,date:Ce(M),venue:ie(y),photo:o,devMode:k,characterFile:k?o:null,skipExtraction:k?U:!1,skipImageGeneration:k?u:!1,skipBackgroundRemoval:k?B:!1,skipVideoGeneration:k?z:!1};ee.log("Form validation passed, showing confirmation modal",{brideName:A.brideName,groomName:A.groomName,date:A.date,venue:A.venue,devMode:A.devMode,skipExtraction:A.skipExtraction,skipImageGeneration:A.skipImageGeneration,skipBackgroundRemoval:A.skipBackgroundRemoval,skipVideoGeneration:A.skipVideoGeneration,photoSize:o?`${(o.size/1024).toFixed(1)} KB`:null}),te("generate_submit",{dev_mode:k}),l(A),a(!0)};return e.jsxs("div",{className:"input-screen",children:[t&&e.jsx("div",{className:"error-banner",children:t}),s&&i&&e.jsx("div",{className:"confirmation-modal-overlay",children:e.jsxs("div",{className:"confirmation-modal",children:[e.jsxs("h2",{className:"modal-header",children:["‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§ï‡•Ä ‡§™‡•Å‡§∑‡•ç‡§ü‡§ø ‡§ï‡§∞‡•á‡§Ç",e.jsx("span",{className:"modal-header-english",children:"(Please Confirm Details)"})]}),e.jsxs("div",{className:"modal-photo-container",children:[e.jsx("img",{src:URL.createObjectURL(o),alt:"Couple photo"}),e.jsx("p",{className:"modal-label",children:"‡§´‡•ã‡§ü‡•ã (Photo)"})]}),e.jsxs("div",{className:"modal-details",children:[e.jsxs("div",{className:"modal-detail-item",children:[e.jsx("span",{className:"modal-detail-label",children:"‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ (Bride's Name):"}),e.jsx("span",{className:"modal-detail-value",children:i.brideName})]}),e.jsxs("div",{className:"modal-detail-item",children:[e.jsx("span",{className:"modal-detail-label",children:"‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡•á ‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ (Bride's Parent's Name):"}),e.jsx("span",{className:"modal-detail-value",children:i.brideParentName})]}),e.jsxs("div",{className:"modal-detail-item",children:[e.jsx("span",{className:"modal-detail-label",children:"‡§¶‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ (Groom's Name):"}),e.jsx("span",{className:"modal-detail-value",children:i.groomName})]}),e.jsxs("div",{className:"modal-detail-item",children:[e.jsx("span",{className:"modal-detail-label",children:"‡§¶‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡•á ‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ (Groom's Parent's Name):"}),e.jsx("span",{className:"modal-detail-value",children:i.groomParentName})]}),e.jsxs("div",{className:"modal-detail-item",children:[e.jsx("span",{className:"modal-detail-label",children:"‡§∏‡§Æ‡§Ø (Time):"}),e.jsx("span",{className:"modal-detail-value",children:i.time})]}),e.jsxs("div",{className:"modal-detail-item",children:[e.jsx("span",{className:"modal-detail-label",children:"‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ (Wedding Date):"}),e.jsx("span",{className:"modal-detail-value",children:i.date})]}),e.jsxs("div",{className:"modal-detail-item",children:[e.jsx("span",{className:"modal-detail-label",children:"‡§∏‡•ç‡§•‡§æ‡§® (Venue):"}),e.jsx("span",{className:"modal-detail-value",children:i.venue})]})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"modal-btn modal-btn-proceed",onClick:()=>{a(!1),r(i)},children:"‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç (Proceed)"}),e.jsx("button",{className:"modal-btn modal-btn-edit",onClick:()=>{a(!1),l(null)},children:"‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç (Edit Details)"})]})]})}),e.jsx("div",{className:"hero-container",style:{marginBottom:"20px"},children:e.jsxs("div",{className:"sample-video-value-hindi",children:[e.jsx("label",{children:"‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç"}),e.jsx("p",{className:"form-hint",children:"Fill in your wedding details"})]})}),e.jsxs("form",{onSubmit:ye,className:"form",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"brideName",children:"Bride Name / ‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),e.jsxs("div",{className:"input-with-voice",children:[e.jsx("input",{type:"text",id:"brideName",value:f,onChange:S=>g(S.target.value),placeholder:"Enter bride's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:W.name,required:!0}),X&&e.jsx("button",{type:"button",className:`voice-btn ${H&&h==="brideName"?"listening":""}`,onClick:()=>F("brideName",g),"aria-label":"Voice input for bride name",children:e.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),e.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),f.length>=W.name&&e.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"brideParentName",children:"Bride's Parent's Name / ‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡•á ‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),e.jsxs("div",{className:"input-with-voice",children:[e.jsx("input",{type:"text",id:"brideParentName",value:b,onChange:S=>I(S.target.value),placeholder:"Enter bride's parent's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:W.name,required:!0}),X&&e.jsx("button",{type:"button",className:`voice-btn ${H&&h==="brideParentName"?"listening":""}`,onClick:()=>F("brideParentName",I),"aria-label":"Voice input for bride parent name",children:e.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),e.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),b.length>=W.name&&e.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"groomName",children:"Groom Name / ‡§¶‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),e.jsxs("div",{className:"input-with-voice",children:[e.jsx("input",{type:"text",id:"groomName",value:x,onChange:S=>_(S.target.value),placeholder:"Enter groom's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:W.name,required:!0}),X&&e.jsx("button",{type:"button",className:`voice-btn ${H&&h==="groomName"?"listening":""}`,onClick:()=>F("groomName",_),"aria-label":"Voice input for groom name",children:e.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),e.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),x.length>=W.name&&e.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"groomParentName",children:"Groom's Parent's Name / ‡§¶‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡•á ‡§™‡§ø‡§§‡§æ ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),e.jsxs("div",{className:"input-with-voice",children:[e.jsx("input",{type:"text",id:"groomParentName",value:L,onChange:S=>O(S.target.value),placeholder:"Enter groom's parent's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:W.name,required:!0}),X&&e.jsx("button",{type:"button",className:`voice-btn ${H&&h==="groomParentName"?"listening":""}`,onClick:()=>F("groomParentName",O),"aria-label":"Voice input for groom parent name",children:e.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),e.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),L.length>=W.name&&e.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weddingTime",children:"Wedding Time / ‡§∂‡§æ‡§¶‡•Ä ‡§ï‡§æ ‡§∏‡§Æ‡§Ø"}),e.jsx("input",{type:"time",id:"weddingTime",value:D,onChange:S=>Q(S.target.value),required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"weddingDate",children:"Wedding Date / ‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ"}),e.jsx("input",{type:"date",id:"weddingDate",value:M,onChange:S=>P(S.target.value),required:!0}),M&&e.jsx("span",{className:"date-preview",children:Ce(M)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"venue",children:"Venue & City / ‡§∏‡•ç‡§•‡§æ‡§®"}),e.jsxs("div",{className:"input-with-voice",children:[e.jsx("input",{type:"text",id:"venue",value:y,onChange:S=>G(S.target.value),placeholder:"e.g., Hotel Rambagh Palace, Jaipur",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:W.venue,required:!0}),X&&e.jsx("button",{type:"button",className:`voice-btn ${H&&h==="venue"?"listening":""}`,onClick:()=>F("venue",G),"aria-label":"Voice input for venue",children:e.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[e.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),e.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),y.length>=W.venue&&e.jsx("span",{className:"field-error",children:"Text is too long / ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),k&&e.jsx("div",{className:"form-group",children:e.jsxs("div",{className:"dev-mode-section",children:[e.jsx("p",{className:"dev-mode-hint",children:"Dev Mode Active - Control which pipeline steps to skip"}),e.jsxs("div",{className:"dev-toggles-panel",children:[e.jsxs("div",{className:"dev-toggle-row",children:[e.jsx("span",{className:"dev-toggle-label",children:"Skip Extraction"}),e.jsx("button",{type:"button",className:`toggle-switch ${U?"toggle-on":""}`,onClick:()=>Y(!U),"aria-label":"Toggle skip extraction",children:e.jsx("span",{className:"toggle-knob"})})]}),e.jsxs("div",{className:"dev-toggle-row",children:[e.jsx("span",{className:"dev-toggle-label",children:"Skip Image Generation"}),e.jsx("button",{type:"button",className:`toggle-switch ${u?"toggle-on":""}`,onClick:()=>V(!u),"aria-label":"Toggle skip image generation",children:e.jsx("span",{className:"toggle-knob"})})]}),e.jsxs("div",{className:"dev-toggle-row",children:[e.jsx("span",{className:"dev-toggle-label",children:"Skip Background Removal"}),e.jsx("button",{type:"button",className:`toggle-switch ${B?"toggle-on":""}`,onClick:()=>q(!B),"aria-label":"Toggle skip background removal",children:e.jsx("span",{className:"toggle-knob"})})]}),e.jsxs("div",{className:"dev-toggle-row",children:[e.jsx("span",{className:"dev-toggle-label",children:"Skip Video Generation"}),e.jsx("button",{type:"button",className:`toggle-switch ${z?"toggle-on":""}`,onClick:()=>de(!z),"aria-label":"Toggle skip video generation",children:e.jsx("span",{className:"toggle-knob"})})]})]})]})}),e.jsx("button",{type:"submit",className:"generate-btn",disabled:!se||!k&&!m.canGenerate,children:k?"Generate Invite (Dev Mode)":"Generate Invite (‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§®‡§æ‡§è‡§Ç)"}),n&&e.jsx("button",{type:"button",className:"go-back-btn",onClick:n,children:"Go Back (‡§µ‡§æ‡§™‡§∏ ‡§ú‡§æ‡§è‡§Ç)"}),!k&&e.jsx("div",{className:`rate-limit-info ${m.remaining<=2?"rate-limit-warning":""}`,children:m.canGenerate?e.jsxs("span",{children:[m.remaining," of ",_e()," generations remaining this week",m.remaining<=2&&" ‚ö†Ô∏è"]}):e.jsxs("span",{className:"rate-limit-exceeded",children:["Limit reached. Resets in ",ke(m.resetAt)]})})]})]})}const xe=[{mrw:"‡§Ö‡§∏‡§≤‡•Ä ‡§¨‡§ú‡§ü ‡§ü‡•á‡§∏‡•ç‡§ü ‡§µ‡•á‡§®‡•ç‡§Ø‡•Ç ‡§ï‡•ã‡§®‡•Ä, ‡§Æ‡§ø‡§†‡§æ‡§à ‡§∞‡•ã ‡§ï‡§æ‡§â‡§Ç‡§ü‡§∞ ‡§π‡•à‡•§",en:"The real budget test isn't the venue, it's the ‡§Æ‡§ø‡§†‡§æ‡§à counter."},{mrw:"‡§Æ‡•á‡§π‡§Æ‡§æ‡§®‡§æ‡§Ç ‡§®‡•á ‡§µ‡§ö‡§®‡§æ‡§Ç ‡§∏‡•Ç‡§Ç ‡§ú‡§º‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§ñ‡§æ‡§®‡§æ ‡§Ø‡§æ‡§¶ ‡§∞‡§π ‡§ú‡§æ‡§µ‡•á‡•§",en:"Guests remember the food longer than the vows."},{mrw:"‡§•‡§æ‡§∞‡•Ä ‡§•‡§æ‡§≤‡•Ä ‡§Æ‡•á‡§Ç ‡§ò‡•Ä ‡§ï‡•ã‡§®‡•Ä ‡§π‡•à ‡§§‡•ã ‡§∏‡§Æ‡§ù ‡§ú‡§æ, ‡§∂‡§æ‡§¶‡•Ä ‡§ó‡§≤‡§§ ‡§π‡•à‡•§",en:"If there's no ghee on your plate, you're probably at the wrong wedding."},{mrw:"‡§ï‡•ã‡§à ‡§≠‡•Ç‡§ñ‡•ã ‡§ï‡•ã‡§®‡•Ä ‡§ú‡§æ‡§µ‡•á, ‡§™‡§∞ ‡§ï‡§à ‡§§‡•ã ‡§∏‡•Ä‡§ß‡•ã ‡§ö‡§æ‡§≤ ‡§≠‡•Ä ‡§ï‡•ã‡§®‡•Ä ‡§™‡§æ‡§µ‡•á‡•§",en:"No one leaves hungry, some leave unable to walk properly."},{mrw:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§∂‡§æ‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§°‡§æ‡§á‡§ü ‡§™‡•ç‡§≤‡§æ‡§®‡§æ‡§Ç ‡§∞‡•Ä ‡§õ‡•Å‡§ü‡•ç‡§ü‡•Ä ‡§π‡•ã ‡§ú‡§æ‡§µ‡•á‡•§",en:"In a Marwadi wedding, diet plans are officially suspended."},{mrw:"‡§∏‡§¨ ‡§∏‡•Ç‡§Ç ‡§≤‡§Ç‡§¨‡•Ä ‡§≤‡§æ‡§á‡§® ‡§¶‡•Ç‡§≤‡•ç‡§π‡§æ-‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§∞‡•Ä ‡§ï‡•ã‡§®‡•Ä, ‡§Æ‡§ø‡§†‡§æ‡§à ‡§∞‡•Ä ‡§π‡•ã‡§µ‡•á‡•§",en:"The longest queue isn't for the couple, it's for the dessert."},{mrw:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§∂‡§æ‡§¶‡•Ä ‡§Æ‡•á‡§Ç ‡§•‡§æ‡§≤‡•Ä ‡§ñ‡§æ‡§≤‡•Ä ‡§ï‡•ã‡§®‡•Ä ‡§π‡•ã‡§µ‡•á, ‡§¨‡§∏ ‡§∞‡•Ä‡§´‡§ø‡§≤‡§æ‡§Ç ‡§∞‡§æ ‡§¨‡•Ä‡§ö ‡§π‡•ã‡§µ‡•á‡•§",en:"At Marwadi weddings, plates are never truly empty ‚Äî only between refills."},{mrw:"‡§≤‡•ã‡§ó ‡§Ü‡§∂‡•Ä‡§∞‡•ç‡§µ‡§æ‡§¶ ‡§¶‡•á‡§£ ‡§Ü‡§µ‡•á, ‡§™‡§£ ‡§∞‡•Å‡§ï‡•ç‡§ï‡•á ‡§®‡§æ‡§∂‡•ç‡§§‡•á ‡§ñ‡§æ‡§§‡§∞‡•§",en:"People come for blessings, stay for the snacks."}];function ht({completed:r=!1,onCancel:t}){const[o,n]=c.useState(0),[s,a]=c.useState(0),[i,l]=c.useState(!1),m=c.useRef(null),p=c.useRef(null);return c.useEffect(()=>{fe("loading")},[]),c.useEffect(()=>(p.current=setInterval(()=>{a(d=>(d+1)%xe.length)},5e3),()=>{p.current&&clearInterval(p.current)}),[]),c.useEffect(()=>{r&&o<100&&(m.current&&(clearTimeout(m.current),m.current=null),l(!0),n(100))},[r,o]),c.useEffect(()=>{if(r||o>=100||o>=98)return;let d;return o<90?d=1e3+Math.random()*2e3:d=5e3,m.current=setTimeout(()=>{n(f=>f>=98?f:f+1)},d),()=>{m.current&&(clearTimeout(m.current),m.current=null)}},[o,r]),e.jsx("div",{className:"loading-screen",children:e.jsxs("div",{className:"loading-content",children:[e.jsx("h2",{className:"loading-text",children:"‡§¨‡§∏ 2 ‡§Æ‡§ø‡§®‡§ü ‡§∏‡§æ ‡§Ü‡§™‡§∞‡•ã ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§® ‡§∞‡§π‡•ç‡§Ø‡•ã ‡§π‡•à üòä"}),e.jsx("div",{className:"mascot-container mascot-container-large",children:e.jsx("img",{src:"/assets/mascot.png",alt:"Loading mascot",className:"mascot mascot-large",onError:d=>{d.target.style.display="none"}})}),e.jsxs("div",{className:"progress-container",children:[e.jsx("div",{className:"progress-bar",children:e.jsx("div",{className:`progress-fill ${i?"completing":""}`,style:{width:`${o}%`}})}),e.jsxs("span",{className:"progress-text",children:[Math.round(o),"%"]})]}),e.jsxs("div",{className:"loading-trivia",children:[e.jsx("p",{className:"trivia-primary",children:xe[s].mrw}),e.jsx("p",{className:"trivia-secondary",children:xe[s].en})]}),t&&e.jsx("button",{className:"cancel-btn",onClick:t,type:"button",children:"Cancel (‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç)"})]})})}function ft({onProceed:r}){c.useEffect(()=>{fe("sample_video")},[]);const t=()=>{te("sample_video_proceed"),r()};return e.jsx("div",{className:"input-screen",children:e.jsxs("div",{className:"form",style:{gap:"16px"},children:[e.jsx("div",{className:"hero-container",children:e.jsxs("div",{className:"sample-video-value-hindi",children:[e.jsx("label",{children:"‡§è‡§ï ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç. ‡§Æ‡§ø‡§®‡§ü‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§è‡§Å WhatsApp-ready ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£."}),e.jsx("p",{className:"form-hint",children:"Upload one photo. Get a WhatsApp-ready video invite in minutes."})]})}),e.jsx("div",{className:"form-group",children:e.jsx("video",{className:"sample-video-player",src:"/assets/sample.mp4",autoPlay:!0,muted:!0,loop:!0,playsInline:!0,controls:!0})}),e.jsx("button",{className:"generate-btn",style:{marginTop:"0"},onClick:t,children:"‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç (Upload Photo)"})]})})}const R=oe("BgRemoval"),ue=2;let me=null,le=null;const vt={model:"small",output:{format:"image/png",quality:1},progress:(r,t,o)=>{if(r==="compute:inference"){const n=Math.round(t/o*100);R.log(`Processing: ${n}%`)}}};async function xt(){if(me)return R.log("Library already loaded, using cached reference"),me;if(le)return R.log("Library loading in progress, waiting..."),le;R.log("Loading library dynamically...");const r=performance.now();return le=ze(()=>import("./index-Cirw06Jz.js"),__vite__mapDeps([0,1])).then(t=>{me=t.removeBackground;const o=performance.now()-r;return R.log("Library loaded",{duration:`${o.toFixed(0)}ms`}),me}).catch(t=>{throw le=null,t}),le}function Ne(r){const[t,o]=r.split(","),n=t.match(/:(.*?);/),s=n?n[1]:"image/png",a=atob(o),i=new Uint8Array(a.length);for(let l=0;l<a.length;l++)i[l]=a.charCodeAt(l);return new Blob([i],{type:s})}function wt(r){return new Promise((t,o)=>{const n=new FileReader;n.onload=()=>t(n.result),n.onerror=o,n.readAsDataURL(r)})}async function Le(r){return new Promise((t,o)=>{const n=new Image;n.onload=()=>{try{const s=document.createElement("canvas");s.width=n.width,s.height=n.height;const a=s.getContext("2d");a.drawImage(n,0,0);const l=a.getImageData(0,0,s.width,s.height).data;let m=0;const p=l.length/4;for(let f=3;f<l.length;f+=4)l[f]<255&&m++;const d=m/p*100;R.log("Background removal validation",{transparentPixels:m,totalPixels:p,transparencyPercent:d.toFixed(2)+"%"}),t(d>=5)}catch(s){o(s)}},n.onerror=()=>o(new Error("Failed to load image for validation")),n.src=r})}async function St(r,t){R.log("Attempting server-side background removal");const o=Ne(r),n=new FormData;n.append("image",o,"image.png");const s=await fetch(`${t}/api/remove-background`,{method:"POST",body:n});if(!s.ok){const i=await s.json().catch(()=>({}));throw new Error(i.error||`Server error: ${s.status}`)}const a=await s.json();if(!a.success)throw new Error(a.error||"Server-side background removal failed");return a.imageDataURL}async function Ke(r,t=""){R.log("Starting background removal",{inputLength:r==null?void 0:r.length});const o=performance.now();let n=null;for(let s=1;s<=ue;s++)try{R.log(`Client-side attempt ${s}/${ue}`),R.log("Step 1: Loading library");const a=await xt();R.log("Step 2: Converting data URL to Blob");const i=Ne(r);R.log("Step 2 complete: Input prepared",{inputSize:`${(i.size/1024).toFixed(1)} KB`}),R.log("Step 3: Calling removeBackground() - this may take a while...");const l=performance.now(),m=new Promise((I,x)=>setTimeout(()=>x(new Error("Client-side timeout (120s)")),12e4)),p=await Promise.race([a(i,vt),m]),d=performance.now()-l;R.log("Step 3 complete: Background removed",{processingTime:`${d.toFixed(0)}ms`,resultSize:`${(p.size/1024).toFixed(1)} KB`}),R.log("Step 4: Converting result to data URL");const f=await wt(p);if(R.log("Step 5: Validating background removal"),!await Le(f))throw new Error("Background removal validation failed - no transparency detected");const b=performance.now()-o;return R.log("Background removal complete (client-side)",{totalDuration:`${b.toFixed(0)}ms`,inputSize:`${(i.size/1024).toFixed(1)} KB`,outputSize:`${(p.size/1024).toFixed(1)} KB`,attempts:s}),f}catch(a){if(n=a,R.warn(`Client-side attempt ${s} failed: ${a.message}`),s<ue){const i=1e3*s;R.log(`Retrying in ${i}ms...`),await new Promise(l=>setTimeout(l,i))}}R.warn(`Client-side background removal failed after ${ue} attempts, trying server-side fallback`,n.message);try{const s=await St(r,t);if(!await Le(s))throw new Error("Server-side background removal validation failed");const i=performance.now()-o;return R.log("Background removal complete (server-side)",{totalDuration:`${i.toFixed(0)}ms`}),s}catch(s){throw R.error("Server-side background removal also failed",s),new Error(`Background removal failed completely. Client: ${n.message}. Server: ${s.message}`)}}const T=oe("CacheStorage"),bt="wedding-invite-cache",Nt=1,ae="processed-images",We="processed-images-metadata";function Ee(){try{return!!window.indexedDB}catch{return!1}}function Ye(){return new Promise((r,t)=>{if(!Ee()){T.warn("IndexedDB not supported, using localStorage fallback"),t(new Error("IndexedDB not supported"));return}const o=window.indexedDB.open(bt,Nt);o.onerror=()=>t(o.error),o.onsuccess=()=>r(o.result),o.onupgradeneeded=n=>{const s=n.target.result;s.objectStoreNames.contains(ae)||(s.createObjectStore(ae,{keyPath:"image_id"}),T.log("Created IndexedDB object store"))}})}function Ae(r){const t=`${r.size}-${r.lastModified}`;return btoa(t).replace(/[+/=]/g,"").substring(0,16)}async function Oe(r,t){try{const o=Date.now(),n="1.0";if(Ee())try{const a=(await Ye()).transaction([ae],"readwrite"),i=a.objectStore(ae),l=yt(t);i.put({image_id:r,data:l,processing_version:n,timestamp:o}),await new Promise((m,p)=>{a.oncomplete=m,a.onerror=()=>p(a.error)}),T.log("Image cached in IndexedDB",{image_id:r,size:`${(l.size/1024).toFixed(1)} KB`,timestamp:o})}catch(s){T.warn("IndexedDB save failed, trying localStorage",s.message),De(r,n,o)}else De(r,n,o)}catch(o){T.error("Failed to cache image",o.message)}}async function Te(r){try{if(!Et(r))return T.log("No cached image found for ID",{image_id:r}),null;if(Ee())try{const a=(await Ye()).transaction([ae],"readonly").objectStore(ae).get(r);return new Promise((i,l)=>{a.onsuccess=()=>{const m=a.result;if(m){T.log("Retrieved cached image from IndexedDB",{image_id:r,timestamp:m.timestamp});const p=new FileReader;p.onload=()=>{i(p.result)},p.onerror=()=>{T.warn("Failed to read cached blob"),i(null)},p.readAsDataURL(m.data)}else T.log("Image not found in IndexedDB"),i(null)},a.onerror=()=>l(a.error)})}catch(o){return T.warn("IndexedDB load failed",o.message),null}return null}catch(t){return T.error("Failed to load cached image",t.message),null}}function De(r,t,o){try{const n={image_id:r,processing_version:t,timestamp:o,cached_at:new Date().toISOString()};localStorage.setItem(`${We}-${r}`,JSON.stringify(n)),T.log("Saved metadata to localStorage",{image_id:r})}catch(n){T.warn("Failed to save metadata to localStorage",n.message)}}function Et(r){try{const t=localStorage.getItem(`${We}-${r}`);return t?JSON.parse(t):null}catch(t){return T.warn("Failed to load metadata from localStorage",t.message),null}}function yt(r){const[t,o]=r.split(","),n=t.match(/:(.*?);/),s=n?n[1]:"image/png",a=atob(o),i=new Uint8Array(a.length);for(let l=0;l<a.length;l++)i[l]=a.charCodeAt(l);return new Blob([i],{type:s})}function $e(r,t="1.0"){return r?r.processing_version!==t?(T.log("Cache invalid due to processing version mismatch",{cached_version:r.processing_version,current_version:t}),!1):!0:!1}const C=oe("ImageProcessing"),It="https://marwadi-nyota.onrender.com".replace(/\/+$/,""),Be="1.0",Pt={extraction:6e4,generation:3e5,evaluation:6e4,bg_removing:18e4},jt={extraction:2,generation:1,evaluation:2,bg_removing:1},E={IDLE:"idle",UPLOADED:"uploaded",EXTRACTING:"extracting",GENERATING:"generating",EVALUATING:"evaluating",BG_REMOVING:"bg_removing",READY:"ready",FAILED:"failed"};class Rt{constructor(){this.state=E.IDLE,this.imageId=null,this.originalImage=null,this.processedImage=null,this.currentStep=null,this.progress=0,this.error=null,this.abortController=null,this.listeners=[],this.extractionComplete=!1,this.extractedDescriptions=null,this.isPhotoProcessed=!1}on(t){return this.listeners.push(t),()=>{this.listeners=this.listeners.filter(o=>o!==t)}}_notify(){this.listeners.forEach(t=>{t({state:this.state,step:this.currentStep,progress:this.progress,error:this.error,processedImage:this.processedImage,extractionComplete:this.extractionComplete,isPhotoProcessed:this.isPhotoProcessed})})}async startProcessingFromGeneration(t,o,n,s={}){if(this.state!==E.IDLE&&this.state!==E.UPLOADED){C.warn("Already processing, cannot start new pipeline",{current_state:this.state});return}this.abortController=new AbortController,this.imageId=Ae(t),this.originalImage=t,this.error=null,this.progress=0,this.extractionComplete=!0,this.extractedDescriptions=n,this.isPhotoProcessed=!1,C.log("Starting image processing from generation step",{image_id:this.imageId,photoSize:`${(t.size/1024).toFixed(1)} KB`,photoType:t.type,hasDescriptions:!!n});try{const a=await Te(this.imageId);if(a&&$e({processing_version:Be})){C.log("Using cached processed image",{image_id:this.imageId}),this.processedImage=a,this.state=E.READY,this.progress=100,this.isPhotoProcessed=!0,this._notify();return}}catch(a){C.warn("Failed to check cache, continuing with pipeline",a.message)}this.state=E.UPLOADED,this._notify();try{if(s.skipImageGeneration||await this._runStep("generation",()=>this._generateImage(t,o,s),"Enhancing your image..."),this.abortController.signal.aborted){this._abort();return}if(s.skipEvaluation||await this._runStep("evaluation",()=>this._evaluateImage(t,o,s),"Evaluating image quality..."),this.abortController.signal.aborted){this._abort();return}if(await this._runStep("bg_removing",()=>this._removeBackground(),"Removing background..."),this.abortController.signal.aborted){this._abort();return}try{await Oe(this.imageId,this.processedImage)}catch(a){C.warn("Failed to save to cache, continuing",a.message)}this.state=E.READY,this.progress=100,this.isPhotoProcessed=!0,this._notify(),C.log("Image processing pipeline complete (from generation)",{image_id:this.imageId,finalImageSize:`${(this._estimateDataURLSize(this.processedImage)/1024).toFixed(1)} KB`,isPhotoProcessed:this.isPhotoProcessed})}catch(a){a.name==="AbortError"?(C.log("Processing cancelled by user"),this.state=E.IDLE):(C.error("Pipeline failed",a.message),this.error=a.message,this.state=E.FAILED,this.processedImage=await this._fileToDataURL(this.originalImage)),this._notify()}}async startProcessing(t,o,n={}){if(this.state!==E.IDLE&&this.state!==E.UPLOADED){C.warn("Already processing, cannot start new pipeline",{current_state:this.state});return}this.abortController=new AbortController,this.imageId=Ae(t),this.originalImage=t,this.error=null,this.progress=0,this.extractionComplete=!1,this.extractedDescriptions=null,this.isPhotoProcessed=!1,C.log("Starting image processing pipeline",{image_id:this.imageId,photoSize:`${(t.size/1024).toFixed(1)} KB`,photoType:t.type});try{const s=await Te(this.imageId);if(s&&$e({processing_version:Be})){C.log("Using cached processed image",{image_id:this.imageId}),this.processedImage=s,this.state=E.READY,this.progress=100,this._notify();return}}catch(s){C.warn("Failed to check cache, continuing with pipeline",s.message)}this.state=E.UPLOADED,this._notify();try{if(await this._runStep("extraction",()=>this._extractImage(t),"Extracting image features..."),this.extractionComplete=!0,this._notify(),this.abortController.signal.aborted){this._abort();return}if(n.skipImageGeneration||await this._runStep("generation",()=>this._generateImage(t,o,n),"Enhancing your image..."),this.abortController.signal.aborted){this._abort();return}if(n.skipEvaluation||await this._runStep("evaluation",()=>this._evaluateImage(t,o,n),"Evaluating image quality..."),this.abortController.signal.aborted){this._abort();return}if(await this._runStep("bg_removing",()=>this._removeBackground(),"Removing background..."),this.abortController.signal.aborted){this._abort();return}try{await Oe(this.imageId,this.processedImage)}catch(s){C.warn("Failed to save to cache, continuing",s.message)}this.state=E.READY,this.progress=100,this.isPhotoProcessed=!0,this._notify(),C.log("Image processing pipeline complete",{image_id:this.imageId,finalImageSize:`${(this._estimateDataURLSize(this.processedImage)/1024).toFixed(1)} KB`,isPhotoProcessed:this.isPhotoProcessed})}catch(s){s.name==="AbortError"?(C.log("Processing cancelled by user"),this.state=E.IDLE):(C.error("Pipeline failed",s.message),this.error=s.message,this.state=E.FAILED,this.processedImage=await this._fileToDataURL(this.originalImage)),this._notify()}}async _runStep(t,o,n){const s=Pt[t],a=jt[t];this.currentStep=t,this.state=this._stateForStep(t),this._notify(),C.log(`Step ${t} starting`,{userMessage:n,timeout:s,maxRetries:a});let i;for(let l=0;l<a;l++)try{const m=await this._withTimeout(o(),s);return C.log(`Step ${t} completed`,{attempt:l+1}),m}catch(m){i=m,C.warn(`Step ${t} failed on attempt ${l+1}`,{error:m.message,willRetry:l<a-1}),l<a-1&&await new Promise(p=>setTimeout(p,1e3*(l+1)))}throw new Error(`Step ${t} failed after ${a} retries: ${i.message}`)}_stateForStep(t){return{extraction:E.EXTRACTING,generation:E.GENERATING,evaluation:E.EVALUATING,bg_removing:E.BG_REMOVING}[t]||E.IDLE}async _extractImage(t){return this.progress=10,this._notify(),new Promise((o,n)=>{const s=new FileReader;s.onload=()=>{this.processedImage=s.result,this.progress=20,this._notify(),o(s.result)},s.onerror=()=>n(new Error("Failed to read image file")),s.readAsDataURL(t)})}async _generateImage(t,o,n){if(this.progress=30,this._notify(),n.skipImageGeneration)return this.processedImage;const s=new FormData;s.append("photo",t);const a=await fetch(`${o}/api/generate`,{method:"POST",body:s,signal:this.abortController.signal});if(!a.ok)throw new Error(`API error: ${a.statusText}`);const i=await a.json();if(!i.success)throw new Error(i.error||"Generation failed");return this.processedImage=i.characterImage,this.progress=40,this._notify(),this.processedImage}async _evaluateImage(t,o,n){return this.progress=50,this._notify(),this.progress=60,this._notify(),{passed:!0,score:1}}async _removeBackground(){return this.progress=70,this._notify(),this.processedImage=await Ke(this.processedImage,It),this.progress=80,this._notify(),this.processedImage}cancel(){C.log("Cancelling image processing"),this.abortController&&this.abortController.abort(),this._abort()}isPhotoFullyProcessed(){return this.isPhotoProcessed}_abort(){this.state=E.IDLE,this.progress=0,this.currentStep=null,this._notify()}_withTimeout(t,o){return Promise.race([t,new Promise((n,s)=>setTimeout(()=>s(new Error(`Operation timed out after ${o}ms`)),o))])}_fileToDataURL(t){return new Promise((o,n)=>{const s=new FileReader;s.onload=()=>o(s.result),s.onerror=()=>n(new Error("Failed to read file")),s.readAsDataURL(t)})}_estimateDataURLSize(t){if(!t)return 0;const o=t.split(",")[1]||"";return Math.ceil(o.length*.75)}getStatus(){return{state:this.state,step:this.currentStep,progress:this.progress,error:this.error,isReady:this.state===E.READY,isFailed:this.state===E.FAILED,processedImage:this.processedImage,extractionComplete:this.extractionComplete,isPhotoProcessed:this.isPhotoProcessed}}isDone(){return this.state===E.READY||this.state===E.FAILED}isImageReady(){return this.state===E.READY&&!!this.processedImage}}let ne=null;function kt(){return ne||(ne=new Rt),ne}function _t(){ne&&(ne.cancel(),ne=null)}const Ct=10*1024*1024,Lt=["image/jpeg","image/png","image/webp","image/gif"],At=r=>r?r.size>Ct?{valid:!1,error:"File too large. Maximum size is 10MB."}:Lt.includes(r.type)?{valid:!0}:{valid:!1,error:"Invalid file type. Please upload a JPEG, PNG, WebP, or GIF image."}:{valid:!1,error:"No file selected"},Z=oe("PhotoUploadScreen");function Ot({onPhotoSelected:r,apiUrl:t}){const[o,n]=c.useState(null),[s,a]=c.useState(null),i=c.useRef(null),[l,m]=c.useState(null),p=c.useRef(null),[d,f]=c.useState({status:"idle",descriptions:null,error:null}),[g,b]=c.useState(0),I=c.useRef(null),x=c.useRef(null);c.useEffect(()=>{fe("photo_upload")},[]),c.useEffect(()=>{p.current=kt()},[]),c.useEffect(()=>p.current?p.current.on(y=>{m(y),Z.log("Processing state updated",{state:y.state,step:y.step,progress:y.progress})}):void 0,[]),c.useEffect(()=>{if(o){const P=URL.createObjectURL(o);return a(P),()=>URL.revokeObjectURL(P)}},[o]),c.useEffect(()=>{if(d.status==="uploading"&&g<90)return I.current=setInterval(()=>{b(P=>{const y=P+2;return y>=90?90:y})},1e3),()=>{I.current&&(clearInterval(I.current),I.current=null)};I.current&&(clearInterval(I.current),I.current=null)},[d.status,g]),c.useEffect(()=>{if(!o||t===void 0)return;x.current=new AbortController;const P=x.current.signal;return(async()=>{var G,k;b(0),f({status:"uploading",descriptions:null,error:null}),Z.log("[EXTRACTION] Step 1: Preparing photo for extraction",{photoSize:`${(o.size/1024).toFixed(1)} KB`,photoType:o.type,photoName:o.name});try{const U=new FormData;U.append("photo",o),Z.log("[EXTRACTION] Step 2: Sending photo to backend, waiting for response...");const Y=await fetch(`${t}/api/extract`,{method:"POST",body:U,signal:P});if(Z.log("[EXTRACTION] Step 3: Response received from backend",{status:Y.status,ok:Y.ok}),!Y.ok){const V=await Y.json().catch(()=>({error:"Extraction failed"}));throw new Error(V.error||"Extraction failed")}const u=await Y.json();if(!u.success)throw new Error(u.error||"Extraction failed");Z.log("[EXTRACTION] Step 4: Extraction complete - response parsed successfully",{hasBride:!!((G=u.descriptions)!=null&&G.bride),hasGroom:!!((k=u.descriptions)!=null&&k.groom)}),b(100),f({status:"complete",descriptions:u.descriptions,error:null}),p.current&&(Z.log("[BACKGROUND] Starting background processing after extraction",{photoSize:`${(o.size/1024).toFixed(1)} KB`}),p.current.startProcessingFromGeneration(o,t,u.descriptions,{skipImageGeneration:!1,skipEvaluation:!1,skipBackgroundRemoval:!1}))}catch(U){if(U.name==="AbortError"){Z.log("[EXTRACTION] Extraction cancelled by user");return}Z.error("[EXTRACTION] Extraction failed",U),b(0),f({status:"failed",descriptions:null,error:U.message})}})(),()=>{x.current&&x.current.abort()}},[o,t]);const _=P=>{const y=Array.from(P.target.files||[]);if(y.length===0)return;const G=y[0],k=At(G);if(!k.valid){alert(k.error),P.target.value="";return}te("photo_selected",{size:`${(G.size/1024).toFixed(1)} KB`,type:G.type}),n(G),P.target.value=""},L=P=>{var y;P==null||P.stopPropagation(),x.current&&(x.current.abort(),x.current=null),p.current&&p.current.cancel(),n(null),a(null),b(0),f({status:"idle",descriptions:null,error:null}),m(null),te("photo_change_click"),(y=i.current)==null||y.click()},O=()=>{if(!o){alert("Please upload a photo first");return}d.status==="complete"&&(te("photo_upload_proceed",{extractionStatus:d.status,processingState:l==null?void 0:l.state,isProcessingComplete:(l==null?void 0:l.state)==="ready"}),r({photo:o,descriptions:d.descriptions,processingService:p.current,processingState:l}))},D=d.status==="uploading",Q=d.status==="complete",M=d.status==="failed";return e.jsx("div",{className:"input-screen photo-upload-screen",children:e.jsxs("div",{className:"form",children:[e.jsx("div",{className:Q?"status-message-box status-success":"hero-container",children:Q?e.jsx("span",{children:"‚úì ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à! (Photo uploaded!)"}):e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° (Photo Upload)/ "}),e.jsx("p",{className:"form-hint",children:"‡§è‡§ï ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§î‡§∞ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç (Choose a clear, good quality photo)"})]})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Couple Photo / ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞"}),o?e.jsx("div",{className:"photo-single",children:e.jsx("div",{className:"photo-card photo-card-clickable",onClick:L,style:{cursor:"pointer"},children:e.jsxs("div",{className:"photo-preview",style:{position:"relative",width:"100%",height:"auto",maxWidth:"280px"},children:[e.jsx("img",{src:s,alt:"Selected photo",style:{width:"100%",height:"auto",display:"block"}}),e.jsx("button",{type:"button",className:"change-photo-btn",onClick:L,"aria-label":"Change photo",children:"Change Photo"}),D&&e.jsx("div",{className:"processing-overlay",children:e.jsxs("div",{className:"processing-indicator",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{className:"processing-text",children:"‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç (Please wait...)"}),e.jsxs("div",{className:"upload-progress-bar",children:[e.jsx("div",{className:"upload-progress-fill",style:{width:`${g}%`}}),e.jsxs("span",{className:"upload-progress-text",children:[Math.round(g),"%"]})]})]})})]})})}):e.jsxs("button",{type:"button",className:"upload-btn upload-btn-large",onClick:()=>{var P;te("photo_upload_click"),(P=i.current)==null||P.click()},children:[e.jsx("span",{className:"upload-icon",children:"+"}),e.jsx("span",{className:"upload-text-hindi",children:"‡§Ö‡§™‡§®‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç"}),e.jsx("span",{className:"upload-hint",children:"Select Your Photo"})]})]}),M&&e.jsxs("div",{className:"status-message-box status-error",children:[e.jsxs("span",{children:["‚ö† ‡§Ö‡§™‡§≤‡•ã‡§° ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ: ",d.error]}),e.jsx("span",{className:"status-hint",children:"‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç (Please try again)"})]}),e.jsx("button",{type:"button",className:"generate-btn",onClick:O,disabled:!o||D||M,children:D?"‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à... (Uploading...)":Q?"‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç (Continue)":"‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç (Select Photo)"}),e.jsx("input",{type:"file",ref:i,accept:"image/*",onChange:_,style:{display:"none"}})]})})}var Me;(function(r){r.LOAD="LOAD",r.EXEC="EXEC",r.FFPROBE="FFPROBE",r.WRITE_FILE="WRITE_FILE",r.READ_FILE="READ_FILE",r.DELETE_FILE="DELETE_FILE",r.RENAME="RENAME",r.CREATE_DIR="CREATE_DIR",r.LIST_DIR="LIST_DIR",r.DELETE_DIR="DELETE_DIR",r.ERROR="ERROR",r.DOWNLOAD="DOWNLOAD",r.PROGRESS="PROGRESS",r.LOG="LOG",r.MOUNT="MOUNT",r.UNMOUNT="UNMOUNT"})(Me||(Me={}));var Ge;(function(r){r.MEMFS="MEMFS",r.NODEFS="NODEFS",r.NODERAWFS="NODERAWFS",r.IDBFS="IDBFS",r.WORKERFS="WORKERFS",r.PROXYFS="PROXYFS"})(Ge||(Ge={}));const K=oe("VideoComposer"),we="https://marwadi-nyota.onrender.com".replace(/\/+$/,"");async function Tt(r,t=1080){return new Promise(o=>{const n=new Image;n.onload=()=>{const s=document.createElement("canvas");let{width:a,height:i}=n;a>t&&(i=i*t/a,a=t),s.width=a,s.height=i,s.getContext("2d").drawImage(n,0,0,a,i),s.toBlob(m=>o(m),"image/png",.85)},n.src=r})}async function Dt({characterImage:r,brideName:t,groomName:o,date:n,time:s,brideParents:a,groomParents:i,onProgress:l}){const m=performance.now();K.log("Starting server-side video composition",{API_URL:we||"(empty - using relative path)",fullURL:`${we}/api/compose-video`,characterImageLength:r==null?void 0:r.length,brideName:t,groomName:o,date:n,time:s,brideParents:a,groomParents:i});const p=new FormData;if(r){const d=await Tt(r);p.append("characterImage",d,"character.png")}return p.append("brideName",t),p.append("groomName",o),p.append("date",n),p.append("time",s),p.append("brideParents",a),p.append("groomParents",i),new Promise((d,f)=>{const g=new XMLHttpRequest;g.upload.onprogress=x=>{if(x.lengthComputable){const _=Math.round(x.loaded/x.total*30);K.log("Server compose upload progress",{progress:`${_}%`}),l(_)}},g.onload=()=>{if(g.status===200){const x=g.getResponseHeader("Content-Type");if(!x||!x.includes("video/mp4")){K.error("Server compose returned non-video response",{contentType:x}),f(new Error("Server returned non-video response. Check API URL configuration."));return}const _=performance.now()-m,L=g.response;K.log("Server-side video composition complete",{totalTime:`${_.toFixed(0)}ms`,outputSize:`${(L.size/1024/1024).toFixed(2)} MB`}),l(100),d(L)}else{K.error("Server compose failed",{status:g.status,statusText:g.statusText});try{const x=g.responseText,_=JSON.parse(x);f(new Error(_.error||"Server composition failed"))}catch(x){const _=g.responseText||"(empty response)",L=g.getResponseHeader("Content-Type")||"(not set)",O=g.getResponseHeader("Content-Length")||"(not set)";K.error("Server compose response unparseable",{status:g.status,statusText:g.statusText,contentType:L,contentLength:O,responseLength:_.length,firstChars:_.slice(0,300),parseError:x.message}),f(new Error("Server composition failed: unexpected response"))}}},g.onerror=()=>{const x=performance.now()-m;K.error("Server compose network error",{totalTime:`${x.toFixed(0)}ms`}),f(new Error("Network error during video composition"))},g.ontimeout=()=>{K.error("Server compose timeout"),f(new Error("Video composition timed out"))};let b=30;const I=setInterval(()=>{b<85&&(b+=2,l(b))},1e3);g.onloadend=()=>{clearInterval(I)},g.open("POST",`${we}/api/compose-video`),g.responseType="blob",g.timeout=3e5,g.send(p)})}async function $t({characterImage:r,brideName:t,groomName:o,date:n,time:s,brideParents:a,groomParents:i,onProgress:l=()=>{}}){const m=performance.now();K.log("=== VIDEO COMPOSITION STARTED (SERVER-SIDE) ===",{brideName:t,groomName:o,date:n,time:s,brideParents:a,groomParents:i,characterImageSize:r?`${(r.length/1024).toFixed(1)}KB`:"N/A",timestamp:new Date().toISOString(),userAgent:navigator.userAgent.slice(0,100)}),l(5);try{const p=await Dt({characterImage:r,brideName:t,groomName:o,date:n,time:s,brideParents:a,groomParents:i,onProgress:l}),d=performance.now()-m;return K.log("=== VIDEO COMPOSITION COMPLETE (SERVER) ===",{totalTime:`${d.toFixed(0)}ms`,totalTimeHuman:`${(d/1e3).toFixed(1)}s`,outputSize:`${(p.size/1024/1024).toFixed(2)} MB`}),p}catch(p){const d=performance.now()-m;throw K.error("=== VIDEO COMPOSITION FAILED ===",{error:p.message,failedAfter:`${d.toFixed(0)}ms`}),p}}const Bt=c.lazy(()=>ze(()=>import("./ResultScreen-WpKwGJZW.js"),__vite__mapDeps([2,1]))),v=oe("App"),Mt=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),e.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"}),e.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),Gt=()=>e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),e.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),e.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),Se="https://marwadi-nyota.onrender.com".replace(/\/+$/,""),j={SAMPLE_VIDEO:"sample_video",PHOTO_UPLOAD:"photo_upload",INPUT:"input",LOADING:"loading",RESULT:"result"},Ut=500,qe=3,Vt=1e3;async function zt(r,t,o=qe,n=null){let s;const a=n?{...t,signal:n}:t;for(let i=0;i<o;i++){if(n!=null&&n.aborted)throw new DOMException("Request was cancelled","AbortError");try{const l=await fetch(r,a);if(l.ok||l.status>=400&&l.status<500)return l;s=new Error(`Server error: ${l.status}`),v.warn(`API attempt ${i+1} failed with status ${l.status}`)}catch(l){if(l.name==="AbortError")throw l;s=l,v.warn(`API attempt ${i+1} failed: ${l.message}`)}if(i<o-1){const l=Vt*Math.pow(2,i);v.log(`Retrying in ${l}ms...`),await new Promise(m=>setTimeout(m,l))}}throw s}function Ft(){const[r,t]=c.useState(typeof navigator<"u"?navigator.onLine:!0);return c.useEffect(()=>{const o=()=>{t(!0),v.log("Network status: online")},n=()=>{t(!1),v.log("Network status: offline")};return window.addEventListener("online",o),window.addEventListener("offline",n),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",n)}},[]),r}function Kt(){const[r,t]=c.useState(j.SAMPLE_VIDEO),[o,n]=c.useState(null),[s,a]=c.useState(null),[i,l]=c.useState(null),[m,p]=c.useState(!1),[d,f]=c.useState(null),[g,b]=c.useState({state:"idle"}),I=c.useRef(null),x=Ft(),[_,L]=c.useState(!0),O=c.useRef(null),D=c.useRef(null);c.useEffect(()=>{const u=new Audio("/assets/bg_audio.mp3");return u.loop=!0,u.volume=.05,O.current=u,()=>{u.pause(),u.src=""}},[]);const Q=c.useCallback(()=>{O.current&&(_?(O.current.pause(),L(!1)):(O.current.play().catch(()=>{v.warn("Audio","Could not play audio")}),L(!0)))},[_]);c.useEffect(()=>{O.current&&(r===j.LOADING?(O.current.play().catch(()=>{L(!1)}),L(!0)):(O.current.pause(),O.current.currentTime=0,L(!1)))},[r]);const M=c.useCallback(()=>{v.log("Sample video complete, navigating to photo upload"),t(j.PHOTO_UPLOAD)},[]),P=c.useCallback(({photo:u,processingService:V,processingState:B})=>{v.log("Photo selected, navigating to input form",{photoSize:`${(u.size/1024).toFixed(1)} KB`,processingState:B==null?void 0:B.state}),f(u),I.current=V,b(B||{state:"idle"}),V&&V.on(q=>{b(q)}),t(j.INPUT)},[]),y=u=>new Promise((V,B)=>{if(u.isDone()){V(u.getStatus());return}const q=u.on(z=>{z.state===E.READY?(q(),V(z)):z.state===E.FAILED&&(q(),B(new Error(z.error||"Processing failed")))})}),G=c.useCallback(async u=>{var B,q,z,de,H;D.current=new AbortController;const V=D.current.signal;n(u),t(j.LOADING),p(!1),l(null),v.log("Generation started",{devMode:u.devMode,brideName:u.brideName,groomName:u.groomName,hasPhoto:!!u.photo,hasCharacterFile:!!u.characterFile,skipExtraction:u.skipExtraction,skipImageGeneration:u.skipImageGeneration,skipBackgroundRemoval:u.skipBackgroundRemoval,skipVideoGeneration:u.skipVideoGeneration,videoComposition:"server-side"});try{let h;const w=I.current,ve=u.devMode&&(u.skipExtraction||u.skipImageGeneration),X=((B=w==null?void 0:w.isPhotoFullyProcessed)==null?void 0:B.call(w))||!1,F=(q=w==null?void 0:w.getStatus())==null?void 0:q.state,se=F&&F!=="idle";if(v.log("Step 1: Checking photo processing status",{isPhotoProcessed:X,serviceState:F,processingStarted:se,isImageReady:w==null?void 0:w.isImageReady()}),w&&!X&&se&&!w.isDone()){v.log("Step 1: Photo not fully processed, waiting for processing to complete");try{const N=await y(w);h=N.processedImage,v.log("Step 1 complete: Photo processing finished",{imageLength:h==null?void 0:h.length,isPhotoProcessed:N.isPhotoProcessed})}catch(N){v.warn("Step 1: Photo processing failed, using fallback",N.message),h=w.getStatus().processedImage}}else if(w!=null&&w.isImageReady()&&X)v.log("Step 1: Using pre-processed image from background service"),h=w.getStatus().processedImage,v.log("Step 1 complete: Pre-processed image ready",{imageLength:h==null?void 0:h.length});else if(se&&!w.isDone()){v.log("Step 1: Background processing active, waiting",{state:F});try{h=(await y(w)).processedImage,v.log("Step 1 complete: Background processing finished",{imageLength:h==null?void 0:h.length})}catch(N){v.warn("Step 1: Background processing failed, using fallback",N.message),h=w.getStatus().processedImage}}else se&&w.isDone()?(h=w.getStatus().processedImage,v.log("Step 1: Using completed processing result",{imageLength:h==null?void 0:h.length,state:F})):ve&&u.characterFile&&(v.log("Step 1: Using local character file (dev mode - skipping API)",{fileName:u.characterFile.name,fileSize:`${(u.characterFile.size/1024).toFixed(1)} KB`,fileType:u.characterFile.type}),h=await new Promise((N,A)=>{const $=new FileReader;$.onload=()=>N($.result),$.onerror=()=>A(new Error("Failed to read character file")),$.readAsDataURL(u.characterFile)}),v.log("Step 1 complete: Character file loaded as data URL",{dataUrlLength:h.length}));if(!h){if(!navigator.onLine)throw new Error("No internet connection. Please check your network and try again.");const N=new FormData;N.append("photo",u.photo),v.log("Step 1: Calling backend API (fallback)",{photoName:u.photo.name,photoSize:`${(u.photo.size/1024).toFixed(1)} KB`,photoType:u.photo.type});const A=performance.now(),$=await zt(`${Se}/api/generate`,{method:"POST",body:N},qe,V);v.log("Step 1 response received",{status:$.status,ok:$.ok,duration:`${(performance.now()-A).toFixed(0)}ms`});const Ie=$.headers.get("content-type");if(!Ie||!Ie.includes("application/json"))throw new Error("Server returned non-JSON response. Check API URL configuration.");const J=await $.json();if(!J.success)throw v.error("Step 1 failed",J.error||"Generation failed"),new Error(J.error||"Generation failed");v.log("Step 1 complete: Backend returned success",{hasCharacterImage:!!J.characterImage,imageLength:(z=J.characterImage)==null?void 0:z.length,evaluationScore:(de=J.evaluation)==null?void 0:de.score,evaluationPassed:(H=J.evaluation)==null?void 0:H.passed}),h=J.characterImage}if((w==null?void 0:w.isImageReady())||w&&!w.isDone())v.log("Step 2: Skipping background removal (already done by processing service)");else if(u.skipBackgroundRemoval)v.log("Step 2: Skipping background removal (dev mode toggle)");else{v.log("Step 2: Starting background removal");const N=performance.now();h=await Ke(h,Se),v.log("Step 2 complete: Background removal successful",{outputLength:h==null?void 0:h.length,duration:`${(performance.now()-N).toFixed(0)}ms`})}let S;if(u.skipVideoGeneration)v.log("Step 3: Skipping video generation (dev mode toggle)"),S=Ne(h),v.log("Step 3 complete: Using image directly (no video)",{imageSize:`${((S==null?void 0:S.size)/1024).toFixed(1)} KB`});else{v.log("Step 3: Starting video composition (server-side)",{brideName:u.brideName,groomName:u.groomName,date:u.date,venue:u.venue,characterImageLength:h==null?void 0:h.length});const N=performance.now();let A=0;S=await $t({characterImage:h,brideName:u.brideName,groomName:u.groomName,date:u.date,time:u.time,brideParents:u.brideParentName,groomParents:u.groomParentName,onProgress:$=>{($>=A+20||$===100)&&(v.log("Video composition progress",{progress:`${$}%`,elapsed:`${(performance.now()-N).toFixed(0)}ms`}),A=$)}}),v.log("Step 3 complete: Video composition finished",{videoSize:`${((S==null?void 0:S.size)/1024/1024).toFixed(2)} MB`,duration:`${(performance.now()-N).toFixed(0)}ms`})}if(a(S),!u.devMode){const N=dt();v.log("Rate limit updated",{count:N.count,remaining:N.remaining})}v.log("Step 4: Showing completion state"),p(!0),await new Promise(N=>setTimeout(N,Ut)),v.log("Step 5: Transitioning to result screen"),t(j.RESULT),v.log("Generation complete - all steps successful")}catch(h){if(h.name==="AbortError"){v.log("Generation cancelled by user");return}v.error("Generation failed",h),l(h.message),t(j.INPUT)}},[]),k=c.useCallback(()=>{D.current&&(D.current.abort(),D.current=null),v.log("User cancelled generation"),t(j.INPUT),n(null),a(null),p(!1),l(null)},[]),U=c.useCallback(()=>{I.current&&I.current.cancel(),_t(),I.current=null,t(j.SAMPLE_VIDEO),n(null),a(null),f(null),b({state:"idle"}),l(null)},[]);c.useCallback(()=>{v.log("Back button clicked",{currentScreen:r}),r===j.PHOTO_UPLOAD?t(j.SAMPLE_VIDEO):r===j.INPUT?t(j.PHOTO_UPLOAD):r===j.RESULT&&t(j.INPUT)},[r]);const Y=()=>e.jsx("div",{className:"loading-fallback",children:e.jsx("div",{className:"loading-spinner"})});return e.jsxs("div",{className:"app",children:[!x&&e.jsx("div",{className:"offline-banner",children:"You are offline. Some features may not work."}),e.jsxs("header",{className:"app-header",children:[e.jsx("div",{className:"app-header-left",children:e.jsx("div",{className:"app-header-logo",children:e.jsx("img",{src:"/assets/app-logo.png",alt:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π",className:"app-header-logo-img"})})}),e.jsxs("div",{className:"app-header-title",children:[e.jsx("h1",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π"}),e.jsx("p",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§ï‡•Ç‡§ï‡•Ç ‡§™‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç"})]}),e.jsx("div",{className:"app-header-actions",children:r===j.LOADING&&e.jsx("button",{className:"music-toggle-btn",onClick:Q,"aria-label":_?"Mute background music":"Play background music",title:_?"Mute music":"Play music",children:_?e.jsx(Mt,{}):e.jsx(Gt,{})})})]}),r===j.SAMPLE_VIDEO&&e.jsx(ft,{onProceed:M}),r===j.PHOTO_UPLOAD&&e.jsx(Ot,{onPhotoSelected:P,apiUrl:Se}),r===j.INPUT&&e.jsx(gt,{onGenerate:G,error:i,photo:d,onBack:()=>t(j.PHOTO_UPLOAD)}),r===j.LOADING&&e.jsx(ht,{completed:m,onCancel:k}),e.jsx(c.Suspense,{fallback:e.jsx(Y,{}),children:r===j.RESULT&&e.jsx(Bt,{inviteVideo:s,brideName:o==null?void 0:o.brideName,groomName:o==null?void 0:o.groomName,onReset:U})})]})}be.createRoot(document.getElementById("root")).render(e.jsx(Xe.StrictMode,{children:e.jsx(Kt,{})}));export{ze as _,te as a,oe as c,e as j,fe as t};
