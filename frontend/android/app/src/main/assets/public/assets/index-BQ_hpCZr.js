const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CGW3Q4m_.js","assets/react-vendor-wGySg1uH.js","assets/ResultScreen-CCL6reoC.js"])))=>i.map(i=>d[i]);
import{r as d,a as Ve,R as He}from"./react-vendor-wGySg1uH.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();var Te={exports:{}},de={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ke=d,We=Symbol.for("react.element"),Ye=Symbol.for("react.fragment"),qe=Object.prototype.hasOwnProperty,Je=Ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Xe={key:!0,ref:!0,__self:!0,__source:!0};function je(t,e,o){var s,n={},i=null,a=null;o!==void 0&&(i=""+o),e.key!==void 0&&(i=""+e.key),e.ref!==void 0&&(a=e.ref);for(s in e)qe.call(e,s)&&!Xe.hasOwnProperty(s)&&(n[s]=e[s]);if(t&&t.defaultProps)for(s in e=t.defaultProps,e)n[s]===void 0&&(n[s]=e[s]);return{$$typeof:We,type:t,key:i,ref:a,props:n,_owner:Je.current}}de.Fragment=Ye;de.jsx=je;de.jsxs=je;Te.exports=de;var r=Te.exports,fe={},Se=Ve;fe.createRoot=Se.createRoot,fe.hydrateRoot=Se.hydrateRoot;const Ze="modulepreload",Qe=function(t){return"/"+t},xe={},Oe=function(e,o,s){let n=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(o.map(l=>{if(l=Qe(l),l in xe)return;xe[l]=!0;const h=l.endsWith(".css"),p=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${p}`))return;const x=document.createElement("link");if(x.rel=h?"stylesheet":Ze,h||(x.as="script"),x.crossOrigin="",x.href=l,c&&x.setAttribute("nonce",c),document.head.appendChild(x),h)return new Promise((E,v)=>{x.addEventListener("load",E),x.addEventListener("error",()=>v(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(a){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=a,window.dispatchEvent(c),!c.defaultPrevented)throw a}return n.then(a=>{for(const c of a||[])c.status==="rejected"&&i(c.reason);return e().catch(i)})};function et(){const[t,e]=d.useState(!1),[o,s]=d.useState(null),n=d.useRef(null),i=d.useRef(null),a=typeof window<"u"&&("SpeechRecognition"in window||"webkitSpeechRecognition"in window),c=d.useCallback((h,p)=>{if(!a){alert("Voice input is not supported in this browser");return}n.current&&n.current.stop();const x=window.SpeechRecognition||window.webkitSpeechRecognition,E=new x;E.lang="en-IN",E.continuous=!1,E.interimResults=!1,E.maxAlternatives=1,i.current=p,E.onstart=()=>{e(!0),s(h)},E.onresult=v=>{const f=v.results[0][0].transcript,D=f.charAt(0).toUpperCase()+f.slice(1);i.current&&i.current(D)},E.onerror=v=>{console.error("Speech recognition error:",v.error),e(!1),s(null),v.error==="not-allowed"&&alert("Microphone access denied. Please allow microphone access.")},E.onend=()=>{e(!1),s(null),n.current=null},n.current=E,E.start()},[a]),l=d.useCallback(()=>{n.current&&n.current.stop()},[]);return{isListening:t,activeField:o,startListening:c,stopListening:l,isSupported:a}}const tt="wedding-invite-dev-mode";function ue(){try{return localStorage.getItem(tt)==="true"}catch{return!1}}function ot(t,e,o=null){if(!ue())return;const n=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${t}]`;o!=null?console.log(`${n} ${e}`,o):console.log(`${n} ${e}`)}function rt(t,e,o){if(!ue())return;const n=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${t}]`;console.error(`${n} ERROR - ${e}:`,o)}function nt(t,e,o){if(!ue())return;const n=`[DEV ${new Date().toISOString().split("T")[1].slice(0,-1)}] [${t}]`;console.warn(`${n} WARN - ${e}:`,o)}function Z(t){return{log:(e,o=null)=>ot(t,e,o),error:(e,o)=>rt(t,e,o),warn:(e,o)=>nt(t,e,o),isEnabled:ue}}function ge(t,e={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event","page_view",{page_title:t,...e})}function ee(t,e={}){typeof window<"u"&&typeof window.gtag=="function"&&window.gtag("event",t,e)}const ce="wedding-invite-rate-limit",X=10,be=7*24*60*60*1e3;function ie(){try{const e=localStorage.getItem(ce);if(e){const o=JSON.parse(e);if(Date.now()>o.resetAt){const s={count:0,resetAt:Date.now()+be};return localStorage.setItem(ce,JSON.stringify(s)),{count:0,remaining:X,resetAt:s.resetAt,canGenerate:!0}}return{count:o.count,remaining:Math.max(0,X-o.count),resetAt:o.resetAt,canGenerate:o.count<X}}}catch(e){console.warn("[RateLimit] Failed to read state:",e)}const t={count:0,resetAt:Date.now()+be};try{localStorage.setItem(ce,JSON.stringify(t))}catch(e){console.warn("[RateLimit] Failed to initialize state:",e)}return{count:0,remaining:X,resetAt:t.resetAt,canGenerate:!0}}function st(){try{const t=ie(),e=t.count+1,o={count:e,resetAt:t.resetAt};return localStorage.setItem(ce,JSON.stringify(o)),{count:e,remaining:Math.max(0,X-e),resetAt:t.resetAt,canGenerate:e<X}}catch(t){return console.warn("[RateLimit] Failed to increment count:",t),ie()}}function ye(t){const e=Date.now(),o=t-e;if(o<=0)return"now";const s=Math.floor(o/(24*60*60*1e3)),n=Math.floor(o%(24*60*60*1e3)/(60*60*1e3));if(s>0)return`${s} day${s>1?"s":""}`;if(n>0)return`${n} hour${n>1?"s":""}`;const i=Math.floor(o/(60*1e3));return`${i} minute${i>1?"s":""}`}function Ie(){return X}const ne=Z("InputScreen"),Fe="wedding-invite-form-cache",it="Hotel Jain Ji Shubham",Q={name:50,venue:150},he=t=>t?t.replace(/[<>]/g,"").replace(/javascript:/gi,"").replace(/on\w+=/gi,"").trim():"";function Ne(t){if(!t)return"";const e=new Date(t),o={day:"numeric",month:"long",year:"numeric"};return e.toLocaleDateString("en-IN",o)}function at(){try{const t=localStorage.getItem(Fe);if(t)return JSON.parse(t)}catch(t){console.warn("Failed to load cached form data:",t)}return null}function lt(t){try{localStorage.setItem(Fe,JSON.stringify(t))}catch(e){console.warn("Failed to save form data to cache:",e)}}function ct({onGenerate:t,error:e,photo:o}){const[s,n]=d.useState(()=>ie());d.useEffect(()=>{ge("input"),n(ie())},[]);const i=d.useMemo(()=>at(),[]),[a,c]=d.useState((i==null?void 0:i.brideName)||""),[l,h]=d.useState((i==null?void 0:i.groomName)||""),[p,x]=d.useState((i==null?void 0:i.weddingDate)||""),[E,v]=d.useState((i==null?void 0:i.venue)||"");d.useEffect(()=>{lt({brideName:a,groomName:l,weddingDate:p,venue:E})},[a,l,p,E]);const f=d.useMemo(()=>E.trim().toLowerCase()===it.toLowerCase(),[E]),[D,G]=d.useState(!1),[j,A]=d.useState(!1),[$,k]=d.useState(!1),[R,U]=d.useState(!1),[P,V]=d.useState(!1),{isListening:O,activeField:W,startListening:pe,stopListening:u,isSupported:C}=et(),b=(_,Y)=>{O&&W===_?u():(ee("voice_input_start",{field_name:_}),pe(_,Y))},z=o!==null,B=_=>{_.preventDefault(),ne.log("Form submission started",{devMode:f,hasPhoto:!!o});const Y=ie();if(n(Y),!Y.canGenerate&&!f){ne.warn("Rate limit","Generation limit reached"),alert(`You've reached the limit of ${Ie()} invites per week. Please try again in ${ye(Y.resetAt)}.`);return}if(!a.trim()||!l.trim()||!p||!E.trim()){ne.warn("Form validation","Missing required fields"),alert("Please fill all fields");return}if(!o){ne.warn("Form validation","Photo required - should not happen"),alert("No photo selected. Please go back and upload a photo.");return}const g={brideName:he(a),groomName:he(l),date:Ne(p),venue:he(E),photo:o,devMode:f,characterFile:f?o:null,skipExtraction:f?D:!1,skipImageGeneration:f?j:!1,skipBackgroundRemoval:f?$:!1,skipVideoGeneration:f?R:!1,forceServerConversion:f?P:!1};ne.log("Form validation passed, calling onGenerate",{brideName:g.brideName,groomName:g.groomName,date:g.date,venue:g.venue,devMode:g.devMode,skipExtraction:g.skipExtraction,skipImageGeneration:g.skipImageGeneration,skipBackgroundRemoval:g.skipBackgroundRemoval,skipVideoGeneration:g.skipVideoGeneration,forceServerConversion:g.forceServerConversion,photoSize:o?`${(o.size/1024).toFixed(1)} KB`:null}),ee("generate_submit",{dev_mode:f}),t(g)};return r.jsxs("div",{className:"input-screen",children:[e&&r.jsx("div",{className:"error-banner",children:e}),r.jsx("div",{className:"hero-container",style:{marginBottom:"20px"},children:r.jsxs("div",{className:"sample-video-value-hindi",children:[r.jsx("label",{children:"‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç"}),r.jsx("p",{className:"form-hint",children:"Fill in your wedding details"})]})}),r.jsxs("form",{onSubmit:B,className:"form",children:[r.jsxs("div",{className:"form-row",children:[r.jsxs("div",{className:"form-group",children:[r.jsx("label",{htmlFor:"groomName",children:"Groom Name / ‡§¶‡•Ç‡§≤‡•ç‡§π‡•á ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),r.jsxs("div",{className:"input-with-voice",children:[r.jsx("input",{type:"text",id:"groomName",value:l,onChange:_=>h(_.target.value),placeholder:"Enter groom's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:Q.name,required:!0}),C&&r.jsx("button",{type:"button",className:`voice-btn ${O&&W==="groomName"?"listening":""}`,onClick:()=>b("groomName",h),"aria-label":"Voice input for groom name",children:r.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[r.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),r.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),l.length>=Q.name&&r.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{htmlFor:"brideName",children:"Bride Name / ‡§¶‡•Å‡§≤‡•ç‡§π‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ"}),r.jsxs("div",{className:"input-with-voice",children:[r.jsx("input",{type:"text",id:"brideName",value:a,onChange:_=>c(_.target.value),placeholder:"Enter bride's name",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:Q.name,required:!0}),C&&r.jsx("button",{type:"button",className:`voice-btn ${O&&W==="brideName"?"listening":""}`,onClick:()=>b("brideName",c),"aria-label":"Voice input for bride name",children:r.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[r.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),r.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),a.length>=Q.name&&r.jsx("span",{className:"field-error",children:"Name is too long / ‡§®‡§æ‡§Æ ‡§ï‡•Ä ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{htmlFor:"weddingDate",children:"Wedding Date / ‡§∂‡§æ‡§¶‡•Ä ‡§ï‡•Ä ‡§§‡§æ‡§∞‡•Ä‡§ñ"}),r.jsx("input",{type:"date",id:"weddingDate",value:p,onChange:_=>x(_.target.value),required:!0}),p&&r.jsx("span",{className:"date-preview",children:Ne(p)})]}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{htmlFor:"venue",children:"Venue & City / ‡§∏‡•ç‡§•‡§æ‡§®"}),r.jsxs("div",{className:"input-with-voice",children:[r.jsx("input",{type:"text",id:"venue",value:E,onChange:_=>v(_.target.value),placeholder:"e.g., Hotel Rambagh Palace, Jaipur",autoComplete:"off",autoCapitalize:"words",inputMode:"text",maxLength:Q.venue,required:!0}),C&&r.jsx("button",{type:"button",className:`voice-btn ${O&&W==="venue"?"listening":""}`,onClick:()=>b("venue",v),"aria-label":"Voice input for venue",children:r.jsxs("svg",{className:"voice-icon",viewBox:"0 0 24 24",fill:"currentColor",children:[r.jsx("path",{d:"M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"}),r.jsx("path",{d:"M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"})]})})]}),E.length>=Q.venue&&r.jsx("span",{className:"field-error",children:"Text is too long / ‡§≤‡§Ç‡§¨‡§æ‡§à ‡§ï‡§Æ ‡§ï‡•Ä‡§ú‡§ø‡§è"})]}),f&&r.jsx("div",{className:"form-group",children:r.jsxs("div",{className:"dev-mode-section",children:[r.jsx("p",{className:"dev-mode-hint",children:"Dev Mode Active - Control which pipeline steps to skip"}),r.jsxs("div",{className:"dev-toggles-panel",children:[r.jsxs("div",{className:"dev-toggle-row",children:[r.jsx("span",{className:"dev-toggle-label",children:"Skip Extraction"}),r.jsx("button",{type:"button",className:`toggle-switch ${D?"toggle-on":""}`,onClick:()=>G(!D),"aria-label":"Toggle skip extraction",children:r.jsx("span",{className:"toggle-knob"})})]}),r.jsxs("div",{className:"dev-toggle-row",children:[r.jsx("span",{className:"dev-toggle-label",children:"Skip Image Generation"}),r.jsx("button",{type:"button",className:`toggle-switch ${j?"toggle-on":""}`,onClick:()=>A(!j),"aria-label":"Toggle skip image generation",children:r.jsx("span",{className:"toggle-knob"})})]}),r.jsxs("div",{className:"dev-toggle-row",children:[r.jsx("span",{className:"dev-toggle-label",children:"Skip Background Removal"}),r.jsx("button",{type:"button",className:`toggle-switch ${$?"toggle-on":""}`,onClick:()=>k(!$),"aria-label":"Toggle skip background removal",children:r.jsx("span",{className:"toggle-knob"})})]}),r.jsxs("div",{className:"dev-toggle-row",children:[r.jsx("span",{className:"dev-toggle-label",children:"Skip Video Generation"}),r.jsx("button",{type:"button",className:`toggle-switch ${R?"toggle-on":""}`,onClick:()=>U(!R),"aria-label":"Toggle skip video generation",children:r.jsx("span",{className:"toggle-knob"})})]}),r.jsxs("div",{className:"dev-toggle-row",children:[r.jsx("span",{className:"dev-toggle-label",children:"Force Server FFmpeg"}),r.jsx("button",{type:"button",className:`toggle-switch ${P?"toggle-on":""}`,onClick:()=>V(!P),"aria-label":"Toggle force server-side video conversion",children:r.jsx("span",{className:"toggle-knob"})})]})]})]})}),r.jsx("button",{type:"submit",className:"generate-btn",disabled:!z||!f&&!s.canGenerate,children:f?"Generate Invite (Dev Mode)":"Generate Invite (‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§®‡§æ‡§è‡§Ç)"}),!f&&r.jsx("div",{className:`rate-limit-info ${s.remaining<=2?"rate-limit-warning":""}`,children:s.canGenerate?r.jsxs("span",{children:[s.remaining," of ",Ie()," generations remaining this week",s.remaining<=2&&" ‚ö†Ô∏è"]}):r.jsxs("span",{className:"rate-limit-exceeded",children:["Limit reached. Resets in ",ye(s.resetAt)]})})]})]})}function dt({completed:t=!1,onCancel:e}){const[o,s]=d.useState(0),n=d.useRef(null);return d.useEffect(()=>{ge("loading")},[]),d.useEffect(()=>{t&&o<100&&(n.current&&(clearTimeout(n.current),n.current=null),s(100))},[t,o]),d.useEffect(()=>{if(t||o>=100||o>=98)return;let i;return o<90?i=1e3+Math.random()*2e3:i=5e3,n.current=setTimeout(()=>{s(a=>a>=98?a:a+1)},i),()=>{n.current&&(clearTimeout(n.current),n.current=null)}},[o,t]),r.jsx("div",{className:"loading-screen",children:r.jsxs("div",{className:"loading-content",children:[r.jsx("h2",{className:"loading-text",children:"‡§¨‡§∏ 2 ‡§Æ‡§ø‡§®‡§ü ‡§∏‡§æ ‡§Ü‡§™‡§∞‡•ã ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§¨‡§® ‡§∞‡§π‡•ç‡§Ø‡•ã ‡§π‡•à üòä"}),r.jsx("div",{className:"mascot-container mascot-container-large",children:r.jsx("img",{src:"/assets/mascot.png",alt:"Loading mascot",className:"mascot mascot-large",onError:i=>{i.target.style.display="none"}})}),r.jsxs("div",{className:"progress-container",children:[r.jsx("div",{className:"progress-bar",children:r.jsx("div",{className:"progress-fill",style:{width:`${o}%`}})}),r.jsxs("span",{className:"progress-text",children:[Math.round(o),"%"]})]}),r.jsx("p",{className:"loading-subtext",children:"Creating your beautiful wedding invite..."}),e&&r.jsx("button",{className:"cancel-btn",onClick:e,type:"button",children:"Cancel (‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç)"})]})})}function ut({onProceed:t}){d.useEffect(()=>{ge("sample_video")},[]);const e=()=>{ee("sample_video_proceed"),t()};return r.jsx("div",{className:"input-screen",children:r.jsxs("div",{className:"form",style:{gap:"16px"},children:[r.jsx("div",{className:"hero-container",children:r.jsxs("div",{className:"sample-video-value-hindi",children:[r.jsx("label",{children:"‡§è‡§ï ‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç. ‡§Æ‡§ø‡§®‡§ü‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§è‡§Å WhatsApp-ready ‡§µ‡•Ä‡§°‡§ø‡§Ø‡•ã ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£."}),r.jsx("p",{className:"form-hint",children:"Upload one photo. Get a WhatsApp-ready video invite in minutes."})]})}),r.jsx("div",{className:"form-group",children:r.jsx("video",{className:"sample-video-player",src:"/assets/sample.mp4",autoPlay:!0,muted:!0,loop:!0,playsInline:!0,controls:!0})}),r.jsx("button",{className:"generate-btn",style:{marginTop:"0"},onClick:e,children:"‡§´‡•ã‡§ü‡•ã ‡§Ö‡§™‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç (Upload Photo)"})]})})}const F=Z("BgRemoval");let le=null,se=null;const gt={model:"small",output:{format:"image/png",quality:1},progress:(t,e,o)=>{if(t==="compute:inference"){const s=Math.round(e/o*100);console.log(`[BgRemoval] Processing: ${s}%`)}}};async function pt(){if(le)return F.log("Library already loaded, using cached reference"),le;if(se)return F.log("Library loading in progress, waiting..."),se;F.log("Loading library dynamically..."),console.log("[BgRemoval] Loading library dynamically...");const t=performance.now();return se=Oe(()=>import("./index-CGW3Q4m_.js"),__vite__mapDeps([0,1])).then(e=>{le=e.removeBackground;const o=performance.now()-t;return F.log("Library loaded",{duration:`${o.toFixed(0)}ms`}),console.log("[BgRemoval] Library loaded"),le}).catch(e=>{throw se=null,e}),se}function $e(t){const[e,o]=t.split(","),s=e.match(/:(.*?);/),n=s?s[1]:"image/png",i=atob(o),a=new Uint8Array(i.length);for(let c=0;c<i.length;c++)a[c]=i.charCodeAt(c);return new Blob([a],{type:n})}function mt(t){return new Promise((e,o)=>{const s=new FileReader;s.onload=()=>e(s.result),s.onerror=o,s.readAsDataURL(t)})}async function Be(t){F.log("Starting background removal",{inputLength:t==null?void 0:t.length}),console.log("[BgRemoval] Starting background removal...");const e=performance.now();try{F.log("Step 1: Loading library");const o=await pt();F.log("Step 2: Converting data URL to Blob");const s=$e(t);F.log("Step 2 complete: Input prepared",{inputSize:`${(s.size/1024).toFixed(1)} KB`}),console.log(`[BgRemoval] Input size: ${(s.size/1024).toFixed(1)} KB`),F.log("Step 3: Calling removeBackground() - this may take a while...");const n=performance.now(),i=await o(s,gt),a=performance.now()-n;F.log("Step 3 complete: Background removed",{processingTime:`${a.toFixed(0)}ms`,resultSize:`${(i.size/1024).toFixed(1)} KB`}),F.log("Step 4: Converting result to data URL");const c=await mt(i),l=performance.now()-e;return F.log("Background removal complete",{totalDuration:`${l.toFixed(0)}ms`,inputSize:`${(s.size/1024).toFixed(1)} KB`,outputSize:`${(i.size/1024).toFixed(1)} KB`}),console.log(`[BgRemoval] Complete in ${l.toFixed(0)}ms`),console.log(`[BgRemoval] Output size: ${(i.size/1024).toFixed(1)} KB`),c}catch(o){throw F.error("Background removal failed",o),console.error("[BgRemoval] Error:",o),new Error(`Background removal failed: ${o.message}`)}}const L=Z("CacheStorage"),ht="wedding-invite-cache",ft=1,oe="processed-images",Ge="processed-images-metadata";function Ee(){try{return!!window.indexedDB}catch{return!1}}function Ue(){return new Promise((t,e)=>{if(!Ee()){L.warn("IndexedDB not supported, using localStorage fallback"),e(new Error("IndexedDB not supported"));return}const o=window.indexedDB.open(ht,ft);o.onerror=()=>e(o.error),o.onsuccess=()=>t(o.result),o.onupgradeneeded=s=>{const n=s.target.result;n.objectStoreNames.contains(oe)||(n.createObjectStore(oe,{keyPath:"image_id"}),L.log("Created IndexedDB object store"))}})}function Re(t){const e=`${t.size}-${t.lastModified}`;return btoa(e).replace(/[+/=]/g,"").substring(0,16)}async function ke(t,e){try{const o=Date.now(),s="1.0";if(Ee())try{const i=(await Ue()).transaction([oe],"readwrite"),a=i.objectStore(oe),c=Et(e);a.put({image_id:t,data:c,processing_version:s,timestamp:o}),await new Promise((l,h)=>{i.oncomplete=l,i.onerror=()=>h(i.error)}),L.log("Image cached in IndexedDB",{image_id:t,size:`${(c.size/1024).toFixed(1)} KB`,timestamp:o})}catch(n){L.warn("IndexedDB save failed, trying localStorage",n.message),Ce(t,s,o)}else Ce(t,s,o)}catch(o){L.error("Failed to cache image",o.message)}}async function Pe(t){try{if(!vt(t))return L.log("No cached image found for ID",{image_id:t}),null;if(Ee())try{const i=(await Ue()).transaction([oe],"readonly").objectStore(oe).get(t);return new Promise((a,c)=>{i.onsuccess=()=>{const l=i.result;if(l){L.log("Retrieved cached image from IndexedDB",{image_id:t,timestamp:l.timestamp});const h=new FileReader;h.onload=()=>{a(h.result)},h.onerror=()=>{L.warn("Failed to read cached blob"),a(null)},h.readAsDataURL(l.data)}else L.log("Image not found in IndexedDB"),a(null)},i.onerror=()=>c(i.error)})}catch(o){return L.warn("IndexedDB load failed",o.message),null}return null}catch(e){return L.error("Failed to load cached image",e.message),null}}function Ce(t,e,o){try{const s={image_id:t,processing_version:e,timestamp:o,cached_at:new Date().toISOString()};localStorage.setItem(`${Ge}-${t}`,JSON.stringify(s)),L.log("Saved metadata to localStorage",{image_id:t})}catch(s){L.warn("Failed to save metadata to localStorage",s.message)}}function vt(t){try{const e=localStorage.getItem(`${Ge}-${t}`);return e?JSON.parse(e):null}catch(e){return L.warn("Failed to load metadata from localStorage",e.message),null}}function Et(t){const[e,o]=t.split(","),s=e.match(/:(.*?);/),n=s?s[1]:"image/png",i=atob(o),a=new Uint8Array(i.length);for(let c=0;c<i.length;c++)a[c]=i.charCodeAt(c);return new Blob([a],{type:n})}function _e(t,e="1.0"){return t?t.processing_version!==e?(L.log("Cache invalid due to processing version mismatch",{cached_version:t.processing_version,current_version:e}),!1):!0:!1}const I=Z("ImageProcessing"),Ae="1.0",wt={extraction:6e4,generation:3e5,evaluation:6e4,bg_removing:12e4},St={extraction:2,generation:1,evaluation:2,bg_removing:1},S={IDLE:"idle",UPLOADED:"uploaded",EXTRACTING:"extracting",GENERATING:"generating",EVALUATING:"evaluating",BG_REMOVING:"bg_removing",READY:"ready",FAILED:"failed"};class xt{constructor(){this.state=S.IDLE,this.imageId=null,this.originalImage=null,this.processedImage=null,this.currentStep=null,this.progress=0,this.error=null,this.abortController=null,this.listeners=[],this.extractionComplete=!1,this.extractedDescriptions=null,this.isPhotoProcessed=!1}on(e){return this.listeners.push(e),()=>{this.listeners=this.listeners.filter(o=>o!==e)}}_notify(){this.listeners.forEach(e=>{e({state:this.state,step:this.currentStep,progress:this.progress,error:this.error,processedImage:this.processedImage,extractionComplete:this.extractionComplete,isPhotoProcessed:this.isPhotoProcessed})})}async startProcessingFromGeneration(e,o,s,n={}){if(this.state!==S.IDLE&&this.state!==S.UPLOADED){I.warn("Already processing, cannot start new pipeline",{current_state:this.state});return}this.abortController=new AbortController,this.imageId=Re(e),this.originalImage=e,this.error=null,this.progress=0,this.extractionComplete=!0,this.extractedDescriptions=s,this.isPhotoProcessed=!1,I.log("Starting image processing from generation step",{image_id:this.imageId,photoSize:`${(e.size/1024).toFixed(1)} KB`,photoType:e.type,hasDescriptions:!!s});try{const i=await Pe(this.imageId);if(i&&_e({processing_version:Ae})){I.log("Using cached processed image",{image_id:this.imageId}),this.processedImage=i,this.state=S.READY,this.progress=100,this.isPhotoProcessed=!0,this._notify();return}}catch(i){I.warn("Failed to check cache, continuing with pipeline",i.message)}this.state=S.UPLOADED,this._notify();try{if(n.skipImageGeneration||await this._runStep("generation",()=>this._generateImage(e,o,n),"Enhancing your image..."),this.abortController.signal.aborted){this._abort();return}if(n.skipEvaluation||await this._runStep("evaluation",()=>this._evaluateImage(e,o,n),"Evaluating image quality..."),this.abortController.signal.aborted){this._abort();return}if(await this._runStep("bg_removing",()=>this._removeBackground(),"Removing background..."),this.abortController.signal.aborted){this._abort();return}try{await ke(this.imageId,this.processedImage)}catch(i){I.warn("Failed to save to cache, continuing",i.message)}this.state=S.READY,this.progress=100,this.isPhotoProcessed=!0,this._notify(),I.log("Image processing pipeline complete (from generation)",{image_id:this.imageId,finalImageSize:`${(this._estimateDataURLSize(this.processedImage)/1024).toFixed(1)} KB`,isPhotoProcessed:this.isPhotoProcessed})}catch(i){i.name==="AbortError"?(I.log("Processing cancelled by user"),this.state=S.IDLE):(I.error("Pipeline failed",i.message),this.error=i.message,this.state=S.FAILED,this.processedImage=await this._fileToDataURL(this.originalImage)),this._notify()}}async startProcessing(e,o,s={}){if(this.state!==S.IDLE&&this.state!==S.UPLOADED){I.warn("Already processing, cannot start new pipeline",{current_state:this.state});return}this.abortController=new AbortController,this.imageId=Re(e),this.originalImage=e,this.error=null,this.progress=0,this.extractionComplete=!1,this.extractedDescriptions=null,this.isPhotoProcessed=!1,I.log("Starting image processing pipeline",{image_id:this.imageId,photoSize:`${(e.size/1024).toFixed(1)} KB`,photoType:e.type});try{const n=await Pe(this.imageId);if(n&&_e({processing_version:Ae})){I.log("Using cached processed image",{image_id:this.imageId}),this.processedImage=n,this.state=S.READY,this.progress=100,this._notify();return}}catch(n){I.warn("Failed to check cache, continuing with pipeline",n.message)}this.state=S.UPLOADED,this._notify();try{if(await this._runStep("extraction",()=>this._extractImage(e),"Extracting image features..."),this.extractionComplete=!0,this._notify(),this.abortController.signal.aborted){this._abort();return}if(s.skipImageGeneration||await this._runStep("generation",()=>this._generateImage(e,o,s),"Enhancing your image..."),this.abortController.signal.aborted){this._abort();return}if(s.skipEvaluation||await this._runStep("evaluation",()=>this._evaluateImage(e,o,s),"Evaluating image quality..."),this.abortController.signal.aborted){this._abort();return}if(await this._runStep("bg_removing",()=>this._removeBackground(),"Removing background..."),this.abortController.signal.aborted){this._abort();return}try{await ke(this.imageId,this.processedImage)}catch(n){I.warn("Failed to save to cache, continuing",n.message)}this.state=S.READY,this.progress=100,this.isPhotoProcessed=!0,this._notify(),I.log("Image processing pipeline complete",{image_id:this.imageId,finalImageSize:`${(this._estimateDataURLSize(this.processedImage)/1024).toFixed(1)} KB`,isPhotoProcessed:this.isPhotoProcessed})}catch(n){n.name==="AbortError"?(I.log("Processing cancelled by user"),this.state=S.IDLE):(I.error("Pipeline failed",n.message),this.error=n.message,this.state=S.FAILED,this.processedImage=await this._fileToDataURL(this.originalImage)),this._notify()}}async _runStep(e,o,s){const n=wt[e],i=St[e];this.currentStep=e,this.state=this._stateForStep(e),this._notify(),I.log(`Step ${e} starting`,{userMessage:s,timeout:n,maxRetries:i});let a;for(let c=0;c<i;c++)try{const l=await this._withTimeout(o(),n);return I.log(`Step ${e} completed`,{attempt:c+1}),l}catch(l){a=l,I.warn(`Step ${e} failed on attempt ${c+1}`,{error:l.message,willRetry:c<i-1}),c<i-1&&await new Promise(h=>setTimeout(h,1e3*(c+1)))}throw new Error(`Step ${e} failed after ${i} retries: ${a.message}`)}_stateForStep(e){return{extraction:S.EXTRACTING,generation:S.GENERATING,evaluation:S.EVALUATING,bg_removing:S.BG_REMOVING}[e]||S.IDLE}async _extractImage(e){return this.progress=10,this._notify(),new Promise((o,s)=>{const n=new FileReader;n.onload=()=>{this.processedImage=n.result,this.progress=20,this._notify(),o(n.result)},n.onerror=()=>s(new Error("Failed to read image file")),n.readAsDataURL(e)})}async _generateImage(e,o,s){if(this.progress=30,this._notify(),s.skipImageGeneration)return this.processedImage;const n=new FormData;n.append("photo",e);const i=await fetch(`${o}/api/generate`,{method:"POST",body:n,signal:this.abortController.signal});if(!i.ok)throw new Error(`API error: ${i.statusText}`);const a=await i.json();if(!a.success)throw new Error(a.error||"Generation failed");return this.processedImage=a.characterImage,this.progress=40,this._notify(),this.processedImage}async _evaluateImage(e,o,s){return this.progress=50,this._notify(),this.progress=60,this._notify(),{passed:!0,score:1}}async _removeBackground(){this.progress=70,this._notify();try{return this.processedImage=await Be(this.processedImage),this.progress=80,this._notify(),this.processedImage}catch(e){return I.warn("Background removal failed, using original image",e.message),this.progress=80,this._notify(),this.processedImage}}cancel(){I.log("Cancelling image processing"),this.abortController&&this.abortController.abort(),this._abort()}isPhotoFullyProcessed(){return this.isPhotoProcessed}_abort(){this.state=S.IDLE,this.progress=0,this.currentStep=null,this._notify()}_withTimeout(e,o){return Promise.race([e,new Promise((s,n)=>setTimeout(()=>n(new Error(`Operation timed out after ${o}ms`)),o))])}_fileToDataURL(e){return new Promise((o,s)=>{const n=new FileReader;n.onload=()=>o(n.result),n.onerror=()=>s(new Error("Failed to read file")),n.readAsDataURL(e)})}_estimateDataURLSize(e){if(!e)return 0;const o=e.split(",")[1]||"";return Math.ceil(o.length*.75)}getStatus(){return{state:this.state,step:this.currentStep,progress:this.progress,error:this.error,isReady:this.state===S.READY,isFailed:this.state===S.FAILED,processedImage:this.processedImage,extractionComplete:this.extractionComplete,isPhotoProcessed:this.isPhotoProcessed}}isDone(){return this.state===S.READY||this.state===S.FAILED}isImageReady(){return this.state===S.READY&&!!this.processedImage}}let te=null;function bt(){return te||(te=new xt),te}function yt(){te&&(te.cancel(),te=null)}const J=Z("PhotoUploadScreen"),It=10*1024*1024,Nt=["image/jpeg","image/png","image/webp","image/gif"],Rt=t=>t?t.size>It?{valid:!1,error:"File too large. Maximum size is 10MB."}:Nt.includes(t.type)?{valid:!0}:{valid:!1,error:"Invalid file type. Please upload a JPEG, PNG, WebP, or GIF image."}:{valid:!1,error:"No file selected"};function kt({onPhotoSelected:t,apiUrl:e}){const[o,s]=d.useState(null),[n,i]=d.useState(null),a=d.useRef(null),[c,l]=d.useState(null),h=d.useRef(null),[p,x]=d.useState({status:"idle",descriptions:null,error:null}),[E,v]=d.useState(0),f=d.useRef(null);d.useEffect(()=>{ge("photo_upload")},[]),d.useEffect(()=>{h.current=bt()},[]),d.useEffect(()=>h.current?h.current.on(R=>{l(R),J.log("Processing state updated",{state:R.state,step:R.step,progress:R.progress})}):void 0,[]),d.useEffect(()=>{if(o){const k=URL.createObjectURL(o);return i(k),()=>URL.revokeObjectURL(k)}},[o]),d.useEffect(()=>{if(p.status==="uploading"&&E<90)return f.current=setInterval(()=>{v(k=>{const R=k+2;return R>=90?90:R})},1e3),()=>{f.current&&(clearInterval(f.current),f.current=null)};f.current&&(clearInterval(f.current),f.current=null)},[p.status,E]),d.useEffect(()=>{if(!o||e===void 0)return;(async()=>{var R,U;v(0),x({status:"uploading",descriptions:null,error:null}),J.log("[EXTRACTION] Step 1: Preparing photo for extraction",{photoSize:`${(o.size/1024).toFixed(1)} KB`,photoType:o.type,photoName:o.name}),console.log("[Frontend] Preparing photo for extraction...");try{const P=new FormData;P.append("photo",o),J.log("[EXTRACTION] Step 2: Sending photo to backend, waiting for response..."),console.log("[Frontend] Sending photo to backend, waiting for response...");const V=await fetch(`${e}/api/extract`,{method:"POST",body:P});if(J.log("[EXTRACTION] Step 3: Response received from backend",{status:V.status,ok:V.ok}),console.log("[Frontend] Response received from backend"),!V.ok){const W=await V.json().catch(()=>({error:"Extraction failed"}));throw new Error(W.error||"Extraction failed")}const O=await V.json();if(!O.success)throw new Error(O.error||"Extraction failed");J.log("[EXTRACTION] Step 4: Extraction complete - response parsed successfully",{hasBride:!!((R=O.descriptions)!=null&&R.bride),hasGroom:!!((U=O.descriptions)!=null&&U.groom)}),console.log("[Frontend] Extraction complete - response parsed successfully"),v(100),x({status:"complete",descriptions:O.descriptions,error:null}),h.current&&(J.log("[BACKGROUND] Starting background processing after extraction",{photoSize:`${(o.size/1024).toFixed(1)} KB`}),console.log("[Frontend] Starting background processing (generation ‚Üí evaluation ‚Üí bg removal)..."),h.current.startProcessingFromGeneration(o,e,O.descriptions,{skipImageGeneration:!1,skipEvaluation:!1,skipBackgroundRemoval:!1}))}catch(P){J.error("[EXTRACTION] Extraction failed",P),console.error("[Frontend] Extraction failed:",P.message),v(0),x({status:"failed",descriptions:null,error:P.message})}})()},[o,e]);const D=k=>{const R=Array.from(k.target.files||[]);if(R.length===0)return;const U=R[0],P=Rt(U);if(!P.valid){alert(P.error),k.target.value="";return}ee("photo_selected",{size:`${(U.size/1024).toFixed(1)} KB`,type:U.type}),s(U),k.target.value=""},G=()=>{if(!o){alert("Please upload a photo first");return}p.status==="complete"&&(ee("photo_upload_proceed",{extractionStatus:p.status,processingState:c==null?void 0:c.state,isProcessingComplete:(c==null?void 0:c.state)==="ready"}),t({photo:o,descriptions:p.descriptions,processingService:h.current,processingState:c}))},j=p.status==="uploading",A=p.status==="complete",$=p.status==="failed";return r.jsx("div",{className:"input-screen photo-upload-screen",children:r.jsxs("div",{className:"form",children:[r.jsx("div",{className:A?"status-message-box status-success":"hero-container",children:A?r.jsx("span",{children:"‚úì ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã ‡§ó‡§à! (Photo uploaded!)"}):r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Photo Upload / ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§Ö‡§™‡§≤‡•ã‡§°"}),r.jsx("p",{className:"form-hint",children:"‡§è‡§ï ‡§Ö‡§ö‡•ç‡§õ‡•Ä ‡§î‡§∞ ‡§∏‡•ç‡§™‡§∑‡•ç‡§ü ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç (Choose a clear, good quality photo)"})]})}),r.jsxs("div",{className:"form-group",children:[r.jsx("label",{children:"Couple Photo / ‡§ú‡•ã‡§°‡§º‡•Ä ‡§ï‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞"}),o?r.jsx("div",{className:"photo-single",children:r.jsx("div",{className:"photo-card",children:r.jsxs("div",{className:"photo-preview",style:{position:"relative",width:"100%",height:"auto",maxWidth:"280px"},children:[r.jsx("img",{src:n,alt:"Selected photo",style:{width:"100%",height:"auto",display:"block"}}),j&&r.jsx("div",{className:"processing-overlay",children:r.jsxs("div",{className:"processing-indicator",children:[r.jsx("div",{className:"spinner"}),r.jsx("p",{className:"processing-text",children:"‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç (Please wait...)"}),r.jsxs("div",{className:"upload-progress-bar",children:[r.jsx("div",{className:"upload-progress-fill",style:{width:`${E}%`}}),r.jsxs("span",{className:"upload-progress-text",children:[Math.round(E),"%"]})]})]})})]})})}):r.jsxs("button",{type:"button",className:"upload-btn upload-btn-large",onClick:()=>{var k;ee("photo_upload_click"),(k=a.current)==null||k.click()},children:[r.jsx("span",{className:"upload-icon",children:"+"}),r.jsx("span",{className:"upload-text-hindi",children:"‡§Ö‡§™‡§®‡•Ä ‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç"}),r.jsx("span",{className:"upload-hint",children:"Select Your Photo"})]})]}),$&&r.jsxs("div",{className:"status-message-box status-error",children:[r.jsxs("span",{children:["‚ö† ‡§Ö‡§™‡§≤‡•ã‡§° ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ: ",p.error]}),r.jsx("span",{className:"status-hint",children:"‡§ï‡•É‡§™‡§Ø‡§æ ‡§™‡•Å‡§®‡§É ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞‡•á‡§Ç (Please try again)"})]}),r.jsx("button",{type:"button",className:"generate-btn",onClick:G,disabled:!o||j||$,children:j?"‡§Ö‡§™‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à... (Uploading...)":A?"‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç (Continue)":"‡§§‡§∏‡•ç‡§µ‡•Ä‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç (Select Photo)"}),r.jsx("input",{type:"file",ref:a,accept:"image/*",onChange:D,style:{display:"none"}})]})})}var Le;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(Le||(Le={}));var De;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(De||(De={}));const M=Z("VideoComposer"),Pt="https://marwadi-nyota.onrender.com".replace(/\/+$/,"");async function Ct(t,e=1080){return new Promise(o=>{const s=new Image;s.onload=()=>{const n=document.createElement("canvas");let{width:i,height:a}=s;i>e&&(a=a*e/i,i=e),n.width=i,n.height=a,n.getContext("2d").drawImage(s,0,0,i,a),n.toBlob(l=>o(l),"image/png",.85)},s.src=t})}async function _t({characterImage:t,brideName:e,groomName:o,date:s,venue:n,onProgress:i}){const a=performance.now();M.log("Starting server-side video composition",{characterImageLength:t==null?void 0:t.length,brideName:e,groomName:o,date:s,venue:n});const c=new FormData;if(t){const l=await Ct(t);c.append("characterImage",l,"character.png")}return c.append("brideName",e),c.append("groomName",o),c.append("date",s),c.append("venue",n),new Promise((l,h)=>{const p=new XMLHttpRequest;p.upload.onprogress=v=>{if(v.lengthComputable){const f=Math.round(v.loaded/v.total*30);M.log("Server compose upload progress",{progress:`${f}%`}),i(f)}},p.onload=()=>{if(p.status===200){const v=p.getResponseHeader("Content-Type");if(!v||!v.includes("video/mp4")){M.error("Server compose returned non-video response",{contentType:v}),h(new Error("Server returned non-video response. Check API URL configuration."));return}const f=performance.now()-a,D=p.response;M.log("Server-side video composition complete",{totalTime:`${f.toFixed(0)}ms`,outputSize:`${(D.size/1024/1024).toFixed(2)} MB`}),i(100),l(D)}else{M.error("Server compose failed",{status:p.status,statusText:p.statusText});try{const v=p.responseText,f=JSON.parse(v);h(new Error(f.error||"Server composition failed"))}catch(v){const f=p.responseText||"(empty response)",D=p.getResponseHeader("Content-Type")||"(not set)",G=p.getResponseHeader("Content-Length")||"(not set)";M.error("Server compose response unparseable",{status:p.status,statusText:p.statusText,contentType:D,contentLength:G,responseLength:f.length,firstChars:f.slice(0,300),parseError:v.message}),h(new Error("Server composition failed: unexpected response"))}}},p.onerror=()=>{const v=performance.now()-a;M.error("Server compose network error",{totalTime:`${v.toFixed(0)}ms`}),h(new Error("Network error during video composition"))},p.ontimeout=()=>{M.error("Server compose timeout"),h(new Error("Video composition timed out"))};let x=30;const E=setInterval(()=>{x<85&&(x+=2,i(x))},1e3);p.onloadend=()=>{clearInterval(E)},p.open("POST",`${Pt}/api/compose-video`),p.responseType="blob",p.timeout=3e5,p.send(c)})}async function At({characterImage:t,brideName:e,groomName:o,date:s,venue:n,onProgress:i=()=>{}}){const a=performance.now();M.log("=== VIDEO COMPOSITION STARTED (SERVER-SIDE) ===",{brideName:e,groomName:o,date:s,venue:n,characterImageSize:t?`${(t.length/1024).toFixed(1)}KB`:"N/A",timestamp:new Date().toISOString(),userAgent:navigator.userAgent.slice(0,100)}),i(5);try{const c=await _t({characterImage:t,brideName:e,groomName:o,date:s,venue:n,onProgress:i}),l=performance.now()-a;return M.log("=== VIDEO COMPOSITION COMPLETE (SERVER) ===",{totalTime:`${l.toFixed(0)}ms`,totalTimeHuman:`${(l/1e3).toFixed(1)}s`,outputSize:`${(c.size/1024/1024).toFixed(2)} MB`}),c}catch(c){const l=performance.now()-a;throw M.error("=== VIDEO COMPOSITION FAILED ===",{error:c.message,failedAfter:`${l.toFixed(0)}ms`}),c}}const Lt=d.lazy(()=>Oe(()=>import("./ResultScreen-CCL6reoC.js"),__vite__mapDeps([2,1]))),m=Z("App"),Dt=()=>r.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),r.jsx("path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14"}),r.jsx("path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07"})]}),Tt=()=>r.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5"}),r.jsx("line",{x1:"23",y1:"9",x2:"17",y2:"15"}),r.jsx("line",{x1:"17",y1:"9",x2:"23",y2:"15"})]}),ve="https://marwadi-nyota.onrender.com".replace(/\/+$/,""),N={SAMPLE_VIDEO:"sample_video",PHOTO_UPLOAD:"photo_upload",INPUT:"input",LOADING:"loading",RESULT:"result"},jt=500,Me=3,Ot=1e3;async function Ft(t,e,o=Me,s=null){let n;const i=s?{...e,signal:s}:e;console.log("========== FETCH DEBUG START =========="),console.log("[FETCH] URL:",t),console.log("[FETCH] API_URL env var:",ve),console.log("[FETCH] Full URL being called:",t),console.log("[FETCH] Method:",(e==null?void 0:e.method)||"GET"),console.log("[FETCH] Has body:",!!(e!=null&&e.body)),console.log("[FETCH] Navigator online:",navigator.onLine),console.log("[FETCH] Window location:",window.location.href),console.log("[FETCH] Window origin:",window.location.origin);try{const a="https://httpbin.org/get";console.log("[FETCH] Testing basic connectivity to httpbin.org...");const c=await fetch(a,{method:"GET",mode:"cors"});console.log("[FETCH] Connectivity test result:",c.status)}catch(a){console.log("[FETCH] Connectivity test FAILED:",a.name,a.message)}for(let a=0;a<o;a++){if(s!=null&&s.aborted)throw new DOMException("Request was cancelled","AbortError");console.log(`[FETCH] Attempt ${a+1}/${o} starting...`);const c=Date.now();try{console.log("[FETCH] About to call fetch()...");const l=await fetch(t,i),h=Date.now()-c;console.log(`[FETCH] Response received in ${h}ms`),console.log("[FETCH] Status:",l.status),console.log("[FETCH] Status Text:",l.statusText),console.log("[FETCH] Response OK:",l.ok),console.log("[FETCH] Response type:",l.type),console.log("[FETCH] Response URL:",l.url);const p={};if(l.headers.forEach((x,E)=>{p[E]=x}),console.log("[FETCH] Response headers:",JSON.stringify(p)),l.ok||l.status>=400&&l.status<500)return console.log("[FETCH] Returning successful response"),console.log("========== FETCH DEBUG END =========="),l;n=new Error(`Server error: ${l.status}`),m.warn(`API attempt ${a+1} failed with status ${l.status}`),console.log("[FETCH] Server error, will retry...")}catch(l){const h=Date.now()-c;if(console.log(`[FETCH] EXCEPTION after ${h}ms`),console.log("[FETCH] Error name:",l.name),console.log("[FETCH] Error message:",l.message),console.log("[FETCH] Error stack:",l.stack),console.log("[FETCH] Full error object:",JSON.stringify(l,Object.getOwnPropertyNames(l))),l.name==="AbortError")throw console.log("[FETCH] Request was aborted"),console.log("========== FETCH DEBUG END =========="),l;n=l,m.warn(`API attempt ${a+1} failed: ${l.message}`)}if(a<o-1){const l=Ot*Math.pow(2,a);console.log(`[FETCH] Retrying in ${l}ms...`),m.log(`Retrying in ${l}ms...`),await new Promise(h=>setTimeout(h,l))}}throw console.log("[FETCH] All retries exhausted, throwing error"),console.log("========== FETCH DEBUG END =========="),n}function $t(){const[t,e]=d.useState(typeof navigator<"u"?navigator.onLine:!0);return d.useEffect(()=>{const o=()=>{e(!0),m.log("Network status: online")},s=()=>{e(!1),m.log("Network status: offline")};return window.addEventListener("online",o),window.addEventListener("offline",s),()=>{window.removeEventListener("online",o),window.removeEventListener("offline",s)}},[]),t}function Bt(){const[t,e]=d.useState(N.SAMPLE_VIDEO),[o,s]=d.useState(null),[n,i]=d.useState(null),[a,c]=d.useState(null),[l,h]=d.useState(!1),[p,x]=d.useState(null),[E,v]=d.useState({state:"idle"}),f=d.useRef(null),D=$t(),[G,j]=d.useState(!0),A=d.useRef(null),$=d.useRef(null);d.useEffect(()=>{const u=new Audio("/assets/bg_audio.mp3");u.loop=!0,u.volume=.05,A.current=u;let C=!1;const b=async()=>{if(A.current&&A.current.paused)try{await A.current.play(),j(!0),console.log("[App] Music started after user interaction")}catch(B){console.log("[App] Could not play audio:",B.message)}document.removeEventListener("click",b),document.removeEventListener("touchstart",b),document.removeEventListener("keydown",b),C=!1};return(async()=>{try{await u.play(),j(!0),console.log("[App] Autoplay successful")}catch{console.log("[App] Autoplay blocked, waiting for user interaction"),document.addEventListener("click",b),document.addEventListener("touchstart",b),document.addEventListener("keydown",b),C=!0}})(),()=>{u.pause(),u.src="",C&&(document.removeEventListener("click",b),document.removeEventListener("touchstart",b),document.removeEventListener("keydown",b))}},[]);const k=d.useCallback(()=>{A.current&&(G?(A.current.pause(),j(!1)):(A.current.play().catch(()=>{console.log("[App] Could not play audio")}),j(!0)))},[G]);d.useEffect(()=>{t===N.RESULT&&A.current&&(A.current.pause(),j(!1),console.log("[App] Stopped background music for result screen"))},[t]);const R=d.useCallback(()=>{m.log("Sample video complete, navigating to photo upload"),e(N.PHOTO_UPLOAD)},[]),U=d.useCallback(({photo:u,processingService:C,processingState:b})=>{m.log("Photo selected, navigating to input form",{photoSize:`${(u.size/1024).toFixed(1)} KB`,processingState:b==null?void 0:b.state}),x(u),f.current=C,v(b||{state:"idle"}),C&&C.on(z=>{v(z)}),e(N.INPUT)},[]),P=u=>new Promise((C,b)=>{if(u.isDone()){C(u.getStatus());return}const z=u.on(B=>{B.state===S.READY?(z(),C(B)):B.state===S.FAILED&&(z(),b(new Error(B.error||"Processing failed")))})}),V=d.useCallback(async u=>{var b,z,B,_,Y;$.current=new AbortController;const C=$.current.signal;s(u),e(N.LOADING),h(!1),c(null),m.log("Generation started",{devMode:u.devMode,brideName:u.brideName,groomName:u.groomName,hasPhoto:!!u.photo,hasCharacterFile:!!u.characterFile,skipExtraction:u.skipExtraction,skipImageGeneration:u.skipImageGeneration,skipBackgroundRemoval:u.skipBackgroundRemoval,skipVideoGeneration:u.skipVideoGeneration,videoComposition:"server-side"});try{let g;const w=f.current,ze=u.devMode&&(u.skipExtraction||u.skipImageGeneration),me=((b=w==null?void 0:w.isPhotoFullyProcessed)==null?void 0:b.call(w))||!1,re=(z=w==null?void 0:w.getStatus())==null?void 0:z.state,ae=re&&re!=="idle";if(m.log("Step 1: Checking photo processing status",{isPhotoProcessed:me,serviceState:re,processingStarted:ae,isImageReady:w==null?void 0:w.isImageReady()}),w&&!me&&ae&&!w.isDone()){m.log("Step 1: Photo not fully processed, waiting for processing to complete"),console.log("[App] Waiting for photo processing to complete (extraction + generation + evaluation + bg removal)...");try{const y=await P(w);g=y.processedImage,m.log("Step 1 complete: Photo processing finished",{imageLength:g==null?void 0:g.length,isPhotoProcessed:y.isPhotoProcessed}),console.log("[App] Photo processing complete")}catch(y){m.warn("Step 1: Photo processing failed, using fallback",y.message),console.log("[App] Photo processing failed, using fallback image"),g=w.getStatus().processedImage}}else if(w!=null&&w.isImageReady()&&me)m.log("Step 1: Using pre-processed image from background service"),console.log("[App] Using pre-processed image (photo processing complete)"),g=w.getStatus().processedImage,m.log("Step 1 complete: Pre-processed image ready",{imageLength:g==null?void 0:g.length});else if(ae&&!w.isDone()){m.log("Step 1: Background processing active, waiting",{state:re}),console.log("[App] Background processing active, waiting...");try{g=(await P(w)).processedImage,m.log("Step 1 complete: Background processing finished",{imageLength:g==null?void 0:g.length}),console.log("[App] Background processing complete")}catch(y){m.warn("Step 1: Background processing failed, using fallback",y.message),console.log("[App] Background processing failed, using fallback image"),g=w.getStatus().processedImage}}else ae&&w.isDone()?(g=w.getStatus().processedImage,m.log("Step 1: Using completed processing result",{imageLength:g==null?void 0:g.length,state:re}),console.log("[App] Using completed processing result")):ze&&u.characterFile&&(m.log("Step 1: Using local character file (dev mode - skipping API)",{fileName:u.characterFile.name,fileSize:`${(u.characterFile.size/1024).toFixed(1)} KB`,fileType:u.characterFile.type}),console.log("[App] Dev mode enabled - using local character file"),g=await new Promise((y,K)=>{const T=new FileReader;T.onload=()=>y(T.result),T.onerror=()=>K(new Error("Failed to read character file")),T.readAsDataURL(u.characterFile)}),m.log("Step 1 complete: Character file loaded as data URL",{dataUrlLength:g.length}),console.log("[App] Character file loaded, skipping API calls"));if(!g){if(!navigator.onLine)throw new Error("No internet connection. Please check your network and try again.");const y=new FormData;y.append("photo",u.photo),m.log("Step 1: Calling backend API (fallback)",{photoName:u.photo.name,photoSize:`${(u.photo.size/1024).toFixed(1)} KB`,photoType:u.photo.type}),console.log("[App] Calling backend API...");const K=performance.now(),T=await Ft(`${ve}/api/generate`,{method:"POST",body:y},Me,C);m.log("Step 1 response received",{status:T.status,ok:T.ok,duration:`${(performance.now()-K).toFixed(0)}ms`});const we=T.headers.get("content-type");if(!we||!we.includes("application/json"))throw new Error("Server returned non-JSON response. Check API URL configuration.");const q=await T.json();if(!q.success)throw m.error("Step 1 failed",q.error||"Generation failed"),new Error(q.error||"Generation failed");m.log("Step 1 complete: Backend returned success",{hasCharacterImage:!!q.characterImage,imageLength:(B=q.characterImage)==null?void 0:B.length,evaluationScore:(_=q.evaluation)==null?void 0:_.score,evaluationPassed:(Y=q.evaluation)==null?void 0:Y.passed}),console.log("[App] Received image from backend"),g=q.characterImage}if((w==null?void 0:w.isImageReady())||w&&!w.isDone())m.log("Step 2: Skipping background removal (already done by processing service)"),console.log("[App] Background already removed by processing service");else if(u.skipBackgroundRemoval)m.log("Step 2: Skipping background removal (dev mode toggle)"),console.log("[App] Skipping background removal (dev mode)");else{m.log("Step 2: Starting background removal"),console.log("[App] Removing background...");const y=performance.now();try{g=await Be(g),m.log("Step 2 complete: Background removal successful",{outputLength:g==null?void 0:g.length,duration:`${(performance.now()-y).toFixed(0)}ms`}),console.log("[App] Background removal complete")}catch(K){m.warn("Step 2",`Background removal failed, using original: ${K.message}`),console.warn("[App] Background removal failed, using original:",K.message)}}let H;if(u.skipVideoGeneration)m.log("Step 3: Skipping video generation (dev mode toggle)"),console.log("[App] Skipping video generation (dev mode)"),H=$e(g),m.log("Step 3 complete: Using image directly (no video)",{imageSize:`${((H==null?void 0:H.size)/1024).toFixed(1)} KB`});else{m.log("Step 3: Starting video composition (server-side)",{brideName:u.brideName,groomName:u.groomName,date:u.date,venue:u.venue,characterImageLength:g==null?void 0:g.length}),console.log("[App] Composing video invite (server-side)...");const y=performance.now();let K=0;H=await At({characterImage:g,brideName:u.brideName,groomName:u.groomName,date:u.date,venue:u.venue,onProgress:T=>{(T>=K+20||T===100)&&(m.log("Video composition progress",{progress:`${T}%`,elapsed:`${(performance.now()-y).toFixed(0)}ms`}),K=T)}}),m.log("Step 3 complete: Video composition finished",{videoSize:`${((H==null?void 0:H.size)/1024/1024).toFixed(2)} MB`,duration:`${(performance.now()-y).toFixed(0)}ms`})}if(i(H),!u.devMode){const y=st();m.log("Rate limit updated",{count:y.count,remaining:y.remaining})}m.log("Step 4: Showing completion state"),console.log("[App] Generation complete! Showing 100% briefly..."),h(!0),await new Promise(y=>setTimeout(y,jt)),m.log("Step 5: Transitioning to result screen"),e(N.RESULT),m.log("Generation complete - all steps successful")}catch(g){if(g.name==="AbortError"){m.log("Generation cancelled by user"),console.log("[App] Generation cancelled by user");return}m.error("Generation failed",g),console.error("[App] Generation error:",g),c(g.message),e(N.INPUT)}},[]),O=d.useCallback(()=>{$.current&&($.current.abort(),$.current=null),m.log("User cancelled generation"),console.log("[App] User cancelled generation"),e(N.INPUT),s(null),i(null),h(!1),c(null)},[]),W=d.useCallback(()=>{f.current&&f.current.cancel(),yt(),f.current=null,e(N.SAMPLE_VIDEO),s(null),i(null),x(null),v({state:"idle"}),c(null)},[]);d.useCallback(()=>{m.log("Back button clicked",{currentScreen:t}),t===N.PHOTO_UPLOAD?e(N.SAMPLE_VIDEO):t===N.INPUT?e(N.PHOTO_UPLOAD):t===N.RESULT&&e(N.INPUT)},[t]);const pe=()=>r.jsx("div",{className:"loading-fallback",children:r.jsx("div",{className:"loading-spinner"})});return r.jsxs("div",{className:"app",children:[!D&&r.jsx("div",{className:"offline-banner",children:"You are offline. Some features may not work."}),r.jsxs("header",{className:"app-header",children:[r.jsx("div",{className:"app-header-logo",children:r.jsx("img",{src:"/assets/app-logo.png",alt:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π",className:"app-header-logo-img"})}),r.jsxs("div",{className:"app-header-title",children:[r.jsx("h1",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§µ‡§ø‡§µ‡§æ‡§π"}),r.jsx("p",{children:"‡§Æ‡§æ‡§∞‡§µ‡§æ‡§°‡§º‡•Ä ‡§ï‡•Ç‡§ï‡•Ç ‡§™‡§§‡•ç‡§∞‡§ø‡§ï‡§æ ‡§¨‡§®‡§æ‡§è‡§Ç"})]}),r.jsx("div",{className:"app-header-actions",children:r.jsx("button",{className:"music-toggle-btn",onClick:k,"aria-label":G?"Mute background music":"Play background music",title:G?"Mute music":"Play music",children:G?r.jsx(Dt,{}):r.jsx(Tt,{})})})]}),t===N.SAMPLE_VIDEO&&r.jsx(ut,{onProceed:R}),t===N.PHOTO_UPLOAD&&r.jsx(kt,{onPhotoSelected:U,apiUrl:ve}),t===N.INPUT&&r.jsx(ct,{onGenerate:V,error:a,photo:p}),t===N.LOADING&&r.jsx(dt,{completed:l,onCancel:O}),r.jsx(d.Suspense,{fallback:r.jsx(pe,{}),children:t===N.RESULT&&r.jsx(Lt,{inviteVideo:n,brideName:o==null?void 0:o.brideName,groomName:o==null?void 0:o.groomName,onReset:W})})]})}fe.createRoot(document.getElementById("root")).render(r.jsx(He.StrictMode,{children:r.jsx(Bt,{})}));export{Oe as _,ee as a,Z as c,r as j,ge as t};
